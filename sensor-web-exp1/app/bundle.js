(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var yapps, app;
  yapps = require('yapps');
  app = yapps.createApp('web', {
    plugins: [],
    verbose: true
  });
  app.init(function(err){
    if (err != null) {
      console.error("exit with err: " + err);
    }
    if (err != null) {
      return process.exit(1);
    }
    return INFO("App ready!!");
  });
}).call(this);

},{"yapps":5}],2:[function(require,module,exports){
(function (__dirname){
// Generated by LiveScript 1.4.0
(function(){
  var express, http, fs, path, colors, handlebars, bodyParser, expressBunyanLogger, ref$, elemIndex, keys, error_responses, NAME, DBGT, INFO, ERR, composeError, composeData, initiation, detectClientIp, trusted_ip, trusted_ip_or_user, secretCurrying, WebServer, exports;
  express = require('express');
  http = require('http');
  fs = require('fs');
  path = require('path');
  colors = require('colors');
  handlebars = require('handlebars');
  bodyParser = require('body-parser');
  expressBunyanLogger = require('express-bunyan-logger');
  ref$ = require('prelude-ls'), elemIndex = ref$.elemIndex, keys = ref$.keys;
  error_responses = require(__dirname + "/web_errors");
  NAME = 'web';
  DBGT = null;
  INFO = null;
  ERR = null;
  composeError = function(req, res, name, err){
    var r, template, context, msg, result;
    err == null && (err = null);
    if (error_responses[name] != null) {
      r = error_responses[name];
      template = handlebars.compile(r.message);
      context = {
        ip: req.ip,
        originalUrl: req.originalUrl,
        err: err
      };
      msg = template(context);
      result = {
        code: r.code,
        error: name,
        url: req.originalUrl,
        message: msg
      };
      ERR(req.method + " " + colors.yellow(req.url) + " " + colors.green(name) + " json = " + JSON.stringify(result));
      return res.status(r.status).json(result);
    } else {
      ERR(colors.yellow(req.url) + " " + colors.green(name) + " json = unknown error");
      return res.status(500).json({
        error: "unknown error: " + name
      });
    }
  };
  composeData = function(req, res, data, code){
    var result;
    code == null && (code = 200);
    result = {
      code: 0,
      error: null,
      message: null,
      url: req.originalUrl,
      data: data
    };
    return res.status(code).json(result);
  };
  initiation = function(req, res, next){
    req.web_context = {};
    return next();
  };
  detectClientIp = function(req, res, next){
    var ip, web_context;
    ip = req.ip;
    web_context = req.web_context;
    web_context.trusted_ip = false;
    if (ip === "127.0.0.1") {
      web_context.trusted_ip = true;
    }
    if (ip.startsWith("192.168.")) {
      web_context.trusted_ip = true;
    }
    if (undefined !== elemIndex(ip, ['118.163.145.217', '118.163.145.218', '118.163.145.219', '118.163.145.220', '118.163.145.221', '118.163.145.222', '59.87.11.170'])) {
      web_context.trusted_ip = true;
    }
    return next();
  };
  trusted_ip = function(req, res, next){
    if (!req.web_context.trusted_ip) {
      return composeError(req, res, 'untrusted_ip');
    }
    return next();
  };
  trusted_ip_or_user = function(req, res, next){
    req.user = {
      name: 'localhost'
    };
    return next();
  };
  secretCurrying = curry$(function(webserver, name, password, done){
    return webserver.secretCheck(name, password, done);
  });
  WebServer = (function(){
    WebServer.displayName = 'WebServer';
    var prototype = WebServer.prototype, constructor = WebServer;
    function WebServer(opts, app){
      var ref$, resource, util, fields;
      this.opts = opts;
      this.app = app;
      DBGT("initiate");
      this.web = null;
      this.routes = {};
      this.api_routes = {};
      this.wss = {};
      this.sys_helpers = this.opts.helpers;
      ref$ = this.sys_helpers, resource = ref$.resource, util = ref$.util;
      this.helpers = {
        composeError: composeError,
        composeData: composeData,
        trusted_ip: trusted_ip,
        trusted_ip_or_user: trusted_ip_or_user
      };
      this._opts = {
        upload_path: resource.resolveWorkPath('work', 'web/upload'),
        port: 6010,
        host: '0.0.0.0',
        headless: true,
        view_verbose: false,
        api: 1,
        express_partial_response: true,
        express_method_overrid: true,
        express_multer: true
      };
      fields = keys(this._opts);
      this._opts = util.copyObject(this._opts, this.opts, fields);
      if (!this._opts.headless) {
        this._opts.js_dest_path = resource.resolveWorkPath('work', 'web/dest');
      }
    }
    prototype.initiateLogger = function(){
      var logger, webMiddleware;
      logger = this.sys_helpers.logger;
      webMiddleware = expressBunyanLogger({
        logger: logger,
        immediate: false,
        levelFn: function(status, err){
          if (200 === status) {
            return 'debug';
          }
          if (201 === status) {
            return 'debug';
          }
          if (status >= 300 && status < 400) {
            return 'debug';
          }
          if (status >= 400 && status < 500) {
            return 'info';
          }
          if (status >= 500) {
            return 'error';
          }
          return 'warn';
        }
      });
      return this.web.use(webMiddleware);
    };
    prototype.initiateView = function(){
      var web, _opts, resource, js_path, img_path, css_path, jade_path, favicon_path, livescript_path, js_dest_path, jade, serveFavicon, livescriptMiddleware, compile;
      if (this._opts.headless) {
        return false;
      }
      web = this.web, _opts = this._opts;
      resource = this.sys_helpers.resource;
      js_path = resource.resolveResourcePath('assets', 'js');
      img_path = resource.resolveResourcePath('assets', 'img');
      css_path = resource.resolveResourcePath('assets', 'css');
      jade_path = resource.resolveResourcePath('assets', 'views');
      favicon_path = resource.resolveResourcePath('assets', 'img/favicon.ico');
      livescript_path = resource.resolveResourcePath('assets', 'ls');
      js_dest_path = _opts.js_dest_path;
      if (fs.existsSync(jade_path)) {
        jade = require('jade');
        INFO("set view engine: jade (" + jade_path.cyan + ")");
        web.set('views', jade_path);
        web.set('view engine', 'jade');
      } else {
        DBG("no view engine (the template directory " + jade_path.cyan + " does not exist)");
      }
      if (fs.existsSync(favicon_path)) {
        serveFavicon = require('serve-favicon');
        web.use(serveFavicon(favicon_path));
        INFO("set favicon (" + favicon_path.cyan + ")");
      } else {
        DBG("no favicon (the icon directory " + favicon_path.cyan + " does not exist)");
      }
      if (fs.existsSync(img_path)) {
        web.use('/img', express['static'](img_path));
        INFO("add /img");
      } else {
        DBG("no /img (" + img_path.cyan + " does not exist)");
      }
      if (fs.existsSync(css_path)) {
        web.use('/css', express['static'](css_path));
        INFO("add /css");
      } else {
        DBG("no /css (" + css_path.cyan + " does not exist)");
      }
      if (fs.existsSync(livescript_path)) {
        livescriptMiddleware = require('./livescript-middleware');
        compile = livescriptMiddleware({
          src: livescript_path,
          dest: js_dest_path
        });
        web.use('/js', compile, express['static'](js_dest_path));
        INFO("add /js (with livescript-middleware)");
      } else {
        DBG("no compiled /js (" + livescript_path.cyan + " does not exist)");
      }
      if (fs.existsSync(js_path)) {
        web.use('/js', express['static'](js_path));
        return INFO("add /js");
      } else {
        return DBG("no raw /js (" + js_path.cyan + " does not exist)");
      }
    };
    prototype.start = function(done){
      var resource, ref$, port, host, upload_path, web, multer, methodOverride, jade_path, i$, point, v, m, api, sio;
      DBGT("preparing middlewares ...");
      resource = this.sys_helpers.resource;
      ref$ = this._opts, port = ref$.port, host = ref$.host, upload_path = ref$.upload_path;
      this.web = web = express();
      this.server = http.createServer(this.web);
      web.set('trust proxy', true);
      web.use(bodyParser.json());
      web.use(bodyParser.urlencoded({
        extended: true
      }));
      DBGT("use middleware: body-parser");
      if (this._opts.express_multer) {
        multer = require('multer');
        web.use(multer({
          dest: upload_path
        }));
        DBGT("use middleware: multer");
      }
      if (this._opts.express_method_overrid) {
        methodOverride = require('method-override');
        web.use(methodOverride());
        DBGT("use middleware: method-override");
      }
      if (this._opts.view_verbose) {
        this.initiateLogger();
        this.initiateView();
      } else {
        this.initiateView();
        this.initiateLogger();
      }
      web.use(initiation);
      web.use(detectClientIp);
      jade_path = web.get('views');
      for (i$ in ref$ = this.routes) {
        (fn$.call(this, i$, ref$[i$]));
      }
      point = "/api/v" + this._opts.api + "/";
      v = this.api_v = new express();
      if (this._opts.express_partial_response) {
        m = require('express-partial-response');
        v.use(m());
      }
      INFO("using " + point + " (partial-response: " + this._opts.express_partial_response + ")");
      for (i$ in ref$ = this.api_routes) {
        (fn1$.call(this, i$, ref$[i$]));
      }
      api = this.api = new express();
      api.use("/v" + this._opts.api, v);
      web.use("/api", api);
      sio = require('socket.io');
      this.io = sio(this.server);
      this.server.on('listening', function(){
        var p;
        p = port + "";
        INFO("listening " + host.yellow + ":" + p.cyan);
        return done();
      });
      for (i$ in ref$ = this.wss) {
        (fn2$.call(this, i$, ref$[i$]));
      }
      DBGT("starting web server ...");
      return this.server.listen(port, host);
      function fn$(name, middleware){
        web.use("/" + name, middleware);
        INFO("add /" + name);
        if (jade_path != null) {
          middleware.set('views', jade_path);
          middleware.set('view engine', 'jade');
        }
      }
      function fn1$(name, middleware){
        v.use("/" + name, middleware);
        INFO("add " + point + name);
      }
      function fn2$(name, handler){
        var s;
        s = this.io.of(name);
        s.on('connection', handler);
        INFO("add handler for ws://localhost/" + name);
      }
    };
    prototype.use = function(name, middleware){
      if (this.web == null) {
        return this.routes[name] = middleware;
      }
    };
    prototype.useApi = function(name, middleware){
      if (this.web == null) {
        return this.api_routes[name] = middleware;
      }
    };
    prototype.useWs = function(name, handler){
      if (this.web == null) {
        return this.wss[name] = handler;
      }
    };
    return WebServer;
  }());
  module.exports = exports = {
    name: NAME,
    attach: function(opts){
      module.logger = opts.helpers.logger;
      DBGT = function(){
        return module.logger.debug.apply(module.logger, arguments);
      };
      INFO = function(){
        return module.logger.info.apply(module.logger, arguments);
      };
      ERR = function(){
        return module.logger.error.apply(module.logger, arguments);
      };
      return this.web = new WebServer(opts, this);
    },
    init: function(done){
      var web, util, _opts, dirs;
      web = this.web;
      util = web.sys_helpers.util;
      _opts = web._opts;
      dirs = [_opts.upload_path];
      if (!_opts.headless) {
        dirs.push(_opts.js_dest_path);
      }
      return util.createDirectories(dirs, function(err){
        return done(err);
      });
    }
  };
  function curry$(f, bound){
    var context,
    _curry = function(args) {
      return f.length > 1 ? function(){
        var params = args ? args.concat() : [];
        context = bound ? context || this : this;
        return params.push.apply(params, arguments) <
            f.length && arguments.length ?
          _curry.call(context, params) : f.apply(context, params);
      } : f;
    };
    return _curry();
  }
}).call(this);

}).call(this,"/Users/yagamy/Work/workspaces/t2t/sandbox/externals/testbox/sensor-web-exp1/modules/y-web")

},{"./livescript-middleware":3,"body-parser":"body-parser","colors":"colors","express":"express","express-bunyan-logger":"express-bunyan-logger","express-partial-response":"express-partial-response","fs":undefined,"handlebars":"handlebars","http":undefined,"jade":"jade","method-override":"method-override","multer":"multer","path":undefined,"prelude-ls":"prelude-ls","serve-favicon":"serve-favicon","socket.io":"socket.io"}],3:[function(require,module,exports){
// Generated by LiveScript 1.4.0
/*
 * Livescript middleware
 * copied from Stylus middleware
 */
(function(){
  /**
   * Module dependencies.
   */
  /*
  require! {
    'uglify-js': {minify}
    LiveScript: livescript
  
    fs
    url
    path: {join, sep, dirname}
    mkdirp
  }
  */
  var minify, livescript, fs, url, mkdirp, path, join, sep, dirname, defaults;
  minify = require('uglify-js').minify;
  livescript = require('livescript');
  fs = require('fs');
  url = require('url');
  mkdirp = require('mkdirp');
  path = require('path');
  join = path.join, sep = path.sep, dirname = path.dirname;
  defaults = {
    compress: false
  };
  module.exports = function(options){
    var dest, src;
    options == null && (options = {});
    if (typeof options === 'string') {
      options = {
        src: options
      };
    }
    options = import$(defaults, options);
    dest = options.dest, src = options.src;
    if (src == null) {
      throw new Error('livescript.middleware() requires "src" directory');
    }
    dest || (dest = src);
    options.compile || (options.compile = function(str, path){
      return livescript.compile(str, {
        bare: options.bare
      });
    });
    return function(req, res, next){
      var path, overlap, jsPath, lsPath, error;
      if (!arrayContains(['GET', 'HEAD'], req.method)) {
        return next();
      }
      path = url.parse(req.url).pathname;
      if (!/\.js$/.test(path)) {
        return next();
      }
      if (arrayContains(['string', 'function'], typeof dest)) {
        overlap = compare(typeof dest === 'function' ? dest(path) : dest, path);
        path = path.slice(overlap.length);
      }
      jsPath = typeof dest === 'function'
        ? dest(path)
        : join(dest, path);
      lsPath = typeof src === 'function'
        ? src(path)
        : join(src, path.replace('.js', '.ls'));
      error = function(err){
        return next(err.code === 'ENOENT' ? null : err);
      };
      if (options.force) {
        return compile();
      }
      fs.stat(lsPath, function(err, lsStats){
        if (err) {
          return error(err);
        }
        return fs.stat(jsPath, function(err, jsStats){
          if (err) {
            if (err.code === 'ENOENT') {
              return compile();
            } else {
              return next(err);
            }
          } else {
            if (lsStats.mtime > jsStats.mtime) {
              return compile();
            } else {
              return next();
            }
          }
        });
      });
      function compile(){
        return fs.readFile(lsPath, 'utf8', function(err, str){
          var js;
          if (err) {
            return error(err);
          }
          try {
            js = options.compile(str, {});
            if (options.compress) {
              js = minify(js, {
                fromString: true
              }).code;
            }
            return mkdirp(dirname(jsPath), 448, function(err){
              if (err) {
                return error(err);
              }
              return fs.writeFile(jsPath, js, 'utf8', next);
            });
          } catch (e$) {
            err = e$;
            return error(err);
          }
        });
      }
      return compile;
    };
  };
  function arrayContains(haystack, needle){
    return -1 !== haystack.indexOf(needle);
  }
  /**
   * get the overlapping path from the end of path A, and the begining of path B.
   *
   * @param {String} pathA
   * @param {String} pathB
   * @return {String}
   * @api private
   */
  function compare(pathA, pathB){
    var overlap;
    pathA = pathA.split(sep);
    pathB = pathB.split(sep);
    overlap = [];
    while (pathA[pathA.length - 1] === pathB[0]) {
      overlap.push(pathA.pop());
      pathB.shift();
    }
    return overlap.join(sep);
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

},{"fs":undefined,"livescript":"livescript","mkdirp":"mkdirp","path":undefined,"uglify-js":"uglify-js","url":undefined}],4:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var express, keys, NAME, DBGT, exports;
  express = require('express');
  keys = require('prelude-ls').keys;
  NAME = 'std-webapi';
  DBGT = null;
  module.exports = exports = {
    name: NAME,
    attach: function(opts){
      module.logger = opts.helpers.logger;
      DBGT = function(){
        return module.logger.debug.apply(module.logger, arguments);
      };
    },
    init: function(done){
      var app, web, parent, ref$, composeError, composeData, std;
      app = this;
      web = app.web, parent = app.parent;
      ref$ = web.helpers, composeError = ref$.composeError, composeData = ref$.composeData;
      std = express();
      std.get('/config', function(req, res){
        var api_routes, wss, plugins, plugin_names, i$, len$, config;
        api_routes = web.api_routes, wss = web.wss;
        plugins = parent.plugin_instances;
        plugin_names = [];
        for (i$ = 0, len$ = plugins.length; i$ < len$; ++i$) {
          (fn$.call(this, i$, plugins[i$]));
        }
        config = {
          name: parent.name,
          type: parent.type,
          plugins: plugin_names,
          api_endpoints: keys(api_routes),
          websocket_namespaces: keys(wss),
          opts: web._opts
        };
        return composeData(req, res, config, 200);
        function fn$(i, p){
          plugin_names.push(p.name);
        }
      });
      std.get('/hello', function(req, res){
        return res.send("world");
      });
      std.get('/time', function(req, res){
        return res.send(JSON.stringify(new Date()) + "");
      });
      std.get('/exit', function(req, res){
        var exit;
        res.send("will shutdown gracefully ...\n");
        exit = function(){
          return process.exit(0);
        };
        return setTimeout(exit, 1000);
      });
      std.get('/restart', function(req, res){
        var exit;
        res.send("will restart immediately ...\n");
        exit = function(){
          return process.exit(230);
        };
        return setTimeout(exit, 1000);
      });
      web.useApi('std', std);
      return done();
    }
  };
}).call(this);

},{"express":"express","prelude-ls":"prelude-ls"}],5:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var loggerCurrying, createApplication, findName, exports;
  loggerCurrying = curry$(function(name, level, message){
    return console.error("yapps[" + name + "]:" + level + ": " + message);
  });
  createApplication = function(type, opts){
    var helpers, app_class, app, error;
    if (opts.verbose != null && opts.verbose) {
      global.DBG = loggerCurrying(type, 'debug');
    } else {
      global.DBG = function(message){};
    }
    global.INFO = loggerCurrying(type, 'info');
    try {
      helpers = {
        util: require('./lib/util'),
        resource: require('./lib/resource'),
        timer: require('./lib/timer'),
        asyncExecutor: require('./lib/async-executor')
      };
      app_class = type === 'web'
        ? require('./lib/apps/WebApp')
        : require('./lib/apps/BaseApp');
      app = new app_class(opts, helpers);
      return app;
    } catch (e$) {
      error = e$;
      INFO("failed to createApplication '" + type + "', err: " + error);
      return process.exit(1);
    }
  };
  findName = function(){
    var ex, regexp, matches, line, tokens;
    ex = new Error();
    regexp = /\(.*\/app.(j|l)s:.*\)/;
    matches = regexp.exec(ex.stack);
    if (matches == null) {
      return 'unknown';
    }
    line = matches[0];
    line = line.substring(1, line.length - 2);
    line.replace(/:.*/, "");
    tokens = line.split('/');
    if (!(tokens.length >= 2)) {
      return 'unknown';
    }
    return tokens[tokens.length - 2];
  };
  module.exports = exports = {
    createApp: function(type, opts){
      var app_type, app_opts;
      app_type = null;
      app_opts = null;
      if (type != null) {
        if ('string' === typeof type) {
          app_type = type;
          app_opts = opts;
        } else if ('object' === typeof type) {
          app_type = 'base';
          app_opts = type;
        }
      } else {
        app_type = 'base';
        app_opts = {};
      }
      if (app_opts.name == null) {
        app_opts.name = findName();
      }
      return createApplication(app_type, app_opts);
    }
  };
  function curry$(f, bound){
    var context,
    _curry = function(args) {
      return f.length > 1 ? function(){
        var params = args ? args.concat() : [];
        context = bound ? context || this : this;
        return params.push.apply(params, arguments) <
            f.length && arguments.length ?
          _curry.call(context, params) : f.apply(context, params);
      } : f;
    };
    return _curry();
  }
}).call(this);

},{"./lib/apps/BaseApp":6,"./lib/apps/WebApp":7,"./lib/async-executor":8,"./lib/resource":9,"./lib/timer":10,"./lib/util":11}],6:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var broadway, optimist, extendify, bunyan, bunyanDebugStream, bunyanRotatingFile, path, colors, applyCmdConfigs, InitFunctions, BaseApp, exports;
  if (process.env['TIME_REQUIRE'] === "true") {
    require('time-require');
  }
  broadway = require('broadway');
  optimist = require('optimist');
  extendify = require('extendify');
  bunyan = require('bunyan');
  bunyanDebugStream = require('bunyan-debug-stream');
  bunyanRotatingFile = require('bunyan-rotating-file');
  path = require('path');
  colors = require('colors');
  applyCmdConfigs = function(settings, type){
    var i$, len$, s, tokens, prop, value, names, lastName, config, j$, len1$, n, results$ = [];
    if (!settings) {
      return;
    }
    settings = settings instanceof Array
      ? settings
      : [settings];
    for (i$ = 0, len$ = settings.length; i$ < len$; ++i$) {
      s = settings[i$];
      tokens = s.split("=");
      prop = tokens[0];
      value = tokens[1];
      if ('"' === value.charAt(0) && '"' === value.charAt(value.length - 1)) {
        value = value.substr(1, value.length - 2);
      } else {
        if ("'" === value.charAt(0) && "'" === value.charAt(value.length - 1)) {
          value = value.substr(1, value.length - 2);
        }
      }
      names = prop.split(".");
      lastName = names.pop();
      config = global.config;
      for (j$ = 0, len1$ = names.length; j$ < len1$; ++j$) {
        n = names[j$];
        config = config[n];
      }
      switch (type) {
      case "string":
        config[lastName] = value;
        break;
      case "integer":
        config[lastName] = parseInt(value);
        break;
      case "boolean":
        config[lastName] = "true" === value.toLowerCase();
        break;
      case "str_array":
        config[lastName] = value.split(',');
        break;
      default:
        config[lastName] = value;
      }
      results$.push(INFO("applying " + prop + " = " + config[lastName]));
    }
    return results$;
  };
  InitFunctions = [
    {
      name: 'string-helpers',
      func: function(){
        if (typeof String.prototype.startsWith !== 'function') {
          String.prototype.startsWith = function(str){
            return str === this.substring(0, str.length);
          };
        }
        if (typeof String.prototype.endsWith !== 'function') {
          return String.prototype.endsWith = function(str){
            return str === this.substring(this.length - str.length, this.length);
          };
        }
      }
    }, {
      name: 'load-config',
      func: function(){
        var resource, opt;
        resource = module.resource;
        opt = optimist.usage('Usage: $0').alias('c', 'config').describe('c', 'the configuration set, might be default, bbb0, ...')['default']('c', 'default').alias('b', 'config_bool').describe('b', 'overwrite a configuration with boolean value, e.g. -b "system.influxServer.secure=false"').alias('s', 'config_string').describe('s', 'overwrite a configuration with boolean value, e.g. -b "system.influxServer.user=smith"').alias('i', 'config_int').describe('i', 'overwrite a configuration with int value, e.g. -b "behavior.notify.influxPeriod=smith"').alias('a', 'config_str_array').describe('a', 'overwrite a configuration with array of strings with delimiter character `COMMA`, e.g. -b "system.influxServer.clusters=aa.test.net,bb.test.net,cc.test.net"').alias('v', 'verbose').describe('v', 'verbose message output (level is changed to `debug`)')['default']('v', false).alias('q', 'quiet').describe('q', 'disable logging outputs to local file, but still outputs to stderr')['default']('q', false).boolean(['h', 'v']);
        global.argv = opt.argv;
        if (global.argv.h) {
          opt.showHelp();
          process.exit(0);
        }
        global.config = resource.loadConfig(global.argv.config);
        if (global.config == null) {
          return process.exit(1);
        }
        applyCmdConfigs(global.argv.s, "string");
        applyCmdConfigs(global.argv.i, "integer");
        applyCmdConfigs(global.argv.b, "boolean");
        return applyCmdConfigs(global.argv.a, "str_array");
      }
    }
  ];
  BaseApp = (function(){
    BaseApp.displayName = 'BaseApp';
    var prototype = BaseApp.prototype, constructor = BaseApp;
    function BaseApp(opts, helpers){
      this.opts = opts;
      this.helpers = helpers;
      DBG("BaseApp constructor");
      this.type = 'base';
      this.name = this.opts.name;
      this.resource = module.resource = helpers.resource;
      this.asyncExecutor = helpers.asyncExecutor;
      this.plugin_instances = [];
    }
    prototype.addPlugin = function(p){
      return this.opts.plugins.push(p);
    };
    prototype.initLogger = function(){
      var plugins, resource, app_name, prefixers, stringifiers, level, logging_dir, logging_opts, logger, app_logger, global_logger;
      plugins = this.opts.plugins;
      resource = this.resource;
      app_name = this.name;
      prefixers = {
        module: function(m){
          if (m.plugin != null && m.plugin) {
            return "plugin::" + m.name;
          }
          if (m.debug != null && m.debug) {
            return "debug::" + m.name;
          }
          return m.name;
        }
      };
      stringifiers = {
        config: function(c){
          return JSON.stringify(c, null, 4);
        }
      };
      /*
      for let p, i in plugins
        config = global.config[p]
        if config? and config[\logger]?
          log_config = config.logger
          if log_config[\prefixers]?
            for let name, func of log_config.prefixers
              if prefixers[name]?
                INFO "plugin[#{p}] loads a duplicate logging prefixer <#{name}>"
              else
                prefixers[name] = func
      
          if log_config[\stringifiers]?
            for let name, func of log_config.stringifiers
              if stringifiers[name]?
                INFO "plugin[#{p}] loads a duplicate logging prefixer <#{name}>"
              else
                stringifiers[name] = func
      */
      if (global.argv.v != null && global.argv.v) {
        DBG("verbose (-v) is enabled");
      }
      level = global.argv.v ? 'debug' : 'info';
      logging_dir = resource.resolveWorkPath('logs', '');
      logging_opts = {
        name: app_name,
        serializers: bunyanDebugStream.serializers,
        streams: [
          {
            level: level,
            type: 'raw',
            stream: bunyanDebugStream({
              out: process.stderr,
              showProcess: false,
              colors: {
                debug: 'gray',
                info: 'white'
              },
              prefixers: prefixers,
              stringifiers: stringifiers
            })
          }, {
            level: 'debug',
            type: 'rotating-file',
            path: logging_dir + "" + path.sep + "/app.log",
            period: '1d',
            count: 7
          }
        ]
      };
      if (global.argv.q) {
        logging_opts.streams.pop();
      }
      this.extendify = extendify();
      if (global.config.logger != null) {
        logging_opts = this.extendify(logging_opts, global.config.logger);
      }
      global.yapp_logger = logger = bunyan.createLogger(logging_opts);
      app_logger = this.logger = logger.child({
        module: {
          name: 'BaseApp'
        }
      });
      app_logger.debug("logger initiated");
      global_logger = logger.child({
        module: {
          name: 'GLOBAL'
        }
      });
      global.DBG = function(){
        return global_logger.debug.apply(global_logger, arguments);
      };
      global.INFO = function(){
        return global_logger.info.apply(global_logger, arguments);
      };
      global.WARN = function(){
        return global_logger.warn.apply(global_logger, arguments);
      };
      global.ERR = function(){
        return global_logger.error.apply(global_logger, arguments);
      };
      global.FATAL = function(){
        return global_logger.fatal.apply(global_logger, arguments);
      };
      return module.DBGT = function(){
        return app_logger.debug.apply(app_logger, arguments);
      };
    };
    prototype.init = function(done){
      var self, asyncExecutor, resource, opts, plugins, i$, ref$, len$, app, tasks, logger, config, context, ae;
      self = this;
      asyncExecutor = self.asyncExecutor, resource = self.resource, opts = self.opts;
      plugins = opts.plugins;
      for (i$ = 0, len$ = (ref$ = InitFunctions).length; i$ < len$; ++i$) {
        (fn$.call(this, i$, ref$[i$]));
      }
      this.initLogger();
      app = this.app = new broadway.App;
      app.parent = self;
      tasks = [
        {
          name: 'dummy',
          func: function(ae, ctx, dbg, done){
            return done();
          }
        }, {
          name: 'load-plugins',
          func: function(ae, ctx, dbg, done){
            var config, app, plugins, self, i$, len$;
            config = ctx.config, app = ctx.app, plugins = ctx.plugins, self = ctx.self;
            for (i$ = 0, len$ = plugins.length; i$ < len$; ++i$) {
              (fn$.call(this, i$, plugins[i$]));
            }
            return done();
            function fn$(i, p){
              var name, logger, helpers, c, error;
              try {
                name = p.NAME;
                logger = self.logger.child({
                  module: {
                    plugin: true,
                    name: name
                  }
                });
                helpers = {
                  logger: logger
                };
                helpers = self.extendify(helpers, self.helpers);
                c = {};
                if (config[name] != null) {
                  c = self.extendify(c, config[name]);
                }
                c = self.extendify(c, {
                  helpers: helpers
                });
                app.use(p, c);
                self.plugin_instances.push(p);
              } catch (e$) {
                error = e$;
                return done(error);
              }
            }
          }
        }, {
          name: 'init-plugins',
          func: function(ae, ctx, dbg, done){
            var app;
            app = ctx.app;
            return app.init(function(err){
              return done(err);
            });
          }
        }, {
          name: 'startup-plugins',
          func: function(ae, ctx, dbg, done){
            dbg("enter");
            return done();
          }
        }
      ];
      logger = self.logger;
      config = global.config;
      context = {
        config: config,
        resource: resource,
        app: app,
        plugins: plugins,
        self: self
      };
      ae = new asyncExecutor({
        type: 'app',
        logger: module.DBGT,
        context: context
      });
      return ae.series(tasks, function(executor, ctx, err, results){
        if (process.env['TIME_REQUIRE'] === "true") {
          return process.exit(0);
        }
        if (err == null) {
          return done();
        }
        self.logger.error(err, "initialization failure");
        return done(err);
      });
      function fn$(i, init_func){
        DBG("booting: " + init_func.name + " ...");
        init_func.func();
      }
    };
    prototype.get = function(name){
      return this.app[name];
    };
    prototype.on = function(){
      var onFunc;
      onFunc = this.app.on;
      return onFunc.apply(this.app, arguments);
    };
    return BaseApp;
  }());
  module.exports = exports = BaseApp;
}).call(this);

},{"broadway":"broadway","bunyan":"bunyan","bunyan-debug-stream":"bunyan-debug-stream","bunyan-rotating-file":"bunyan-rotating-file","colors":"colors","extendify":"extendify","optimist":"optimist","path":undefined,"time-require":"time-require"}],7:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var yWeb, yWebapiStd, BaseApp, WebApp, exports;
  yWeb = require('y-web');
  yWebapiStd = require('y-webapi-std');
  BaseApp = require("./BaseApp");
  WebApp = (function(superclass){
    var prototype = extend$((import$(WebApp, superclass).displayName = 'WebApp', WebApp), superclass).prototype, constructor = WebApp;
    function WebApp(opts, helpers){
      this.opts = opts;
      this.helpers = helpers;
      WebApp.superclass.call(this, opts, helpers);
      this.addPlugin(require('y-web'));
      this.addPlugin(require('y-webapi-std'));
    }
    prototype.init = function(done){
      var self;
      self = this;
      return superclass.prototype.init.call(this, function(err){
        var web;
        if (err != null) {
          return done(err);
        }
        web = self.app.web;
        return web.start(done);
      });
    };
    return WebApp;
  }(BaseApp));
  module.exports = exports = WebApp;
  function extend$(sub, sup){
    function fun(){} fun.prototype = (sub.superclass = sup).prototype;
    (sub.prototype = new fun).constructor = sub;
    if (typeof sup.extended == 'function') sup.extended(sub);
    return sub;
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
}).call(this);

},{"./BaseApp":6,"y-web":2,"y-webapi-std":4}],8:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var async, colors, uid, loggerCurrying, runTaskCurrying, seriesEndCurrying, exports, AsyncExecutor;
  async = require('async');
  colors = require('colors');
  uid = require('uid');
  loggerCurrying = curry$(function(executor, task_name, logger, message){
    var num, id, prefix, text;
    num = executor.num + "";
    id = executor.id + "-" + num;
    prefix = executor.type + "[" + id.gray + "]." + task_name;
    text = prefix + " " + message;
    if (logger != null) {
      return logger(text);
    }
    return console.log(text);
  });
  runTaskCurrying = curry$(function(executor, context, logger, task_name, func, cb){
    var DBG, error;
    DBG = loggerCurrying(executor, task_name, logger);
    try {
      return func(executor, context, DBG, function(err, result){
        return cb(err, result);
      });
    } catch (e$) {
      error = e$;
      DBG(error.stack.red + "");
      return cb(error, null);
    }
  });
  seriesEndCurrying = curry$(function(executor, cb, err, results){
    return cb(executor, executor.context, err, results);
  });
  module.exports = exports = AsyncExecutor = (function(){
    AsyncExecutor.displayName = 'AsyncExecutor';
    var prototype = AsyncExecutor.prototype, constructor = AsyncExecutor;
    function AsyncExecutor(options){
      var type, logger, context, id;
      this.options = options;
      if (options != null) {
        type = options.type, logger = options.logger, context = options.context, id = options.id;
      }
      this.context = context != null
        ? context
        : {};
      this.type = type != null ? type : "unknown";
      this.logger = logger != null
        ? logger
        : console.log;
      this.id = id != null
        ? id
        : uid();
      this.num = 0;
    }
    prototype.series = function(tasks, callback){
      var new_funcs, i$, len$, end;
      new_funcs = [];
      for (i$ = 0, len$ = tasks.length; i$ < len$; ++i$) {
        (fn$.call(this, i$, tasks[i$]));
      }
      end = seriesEndCurrying(this, callback);
      async.series(new_funcs, end);
      return this.num = this.num + 1;
      function fn$(i, t){
        var func;
        func = runTaskCurrying(this, this.context, this.logger, t.name, t.func);
        new_funcs.push(func);
      }
    };
    return AsyncExecutor;
  }());
  function curry$(f, bound){
    var context,
    _curry = function(args) {
      return f.length > 1 ? function(){
        var params = args ? args.concat() : [];
        context = bound ? context || this : this;
        return params.push.apply(params, arguments) <
            f.length && arguments.length ?
          _curry.call(context, params) : f.apply(context, params);
      } : f;
    };
    return _curry();
  }
}).call(this);

},{"async":"async","colors":"colors","uid":"uid"}],9:[function(require,module,exports){
(function (__dirname){
// Generated by LiveScript 1.4.0
(function(){
  var fs, path, async, settings, DEBUG, CHECK, LOAD_CONFIG, resource, exports;
  fs = require('fs');
  path = require('path');
  async = require('async');
  settings = {
    program_name: null,
    app_dir: null,
    work_dir: null,
    config_dir: null
  };
  DEBUG = function(message){
    if (process.env.VERBOSE) {
      return console.error(message);
    }
  };
  CHECK = function(p){
    var config_dir, log_dir, dirs, error;
    config_dir = path.resolve(p + "" + path.sep + "config");
    log_dir = path.resolve(p + "" + path.sep + "logs");
    DEBUG("checking " + path.resolve(p));
    try {
      dirs = fs.readdirSync(config_dir);
      if (!fs.existsSync(log_dir)) {
        fs.mkdirSync(log_dir);
      }
      settings.work_dir = p;
      settings.config_dir = config_dir;
      console.log("use " + path.resolve(p) + " as work_dir");
      return console.log("use " + settings.app_dir + " as app_dir");
    } catch (e$) {
      error = e$;
      return DEBUG("checking " + path.resolve(p) + " but failed");
    }
  };
  if (process.argv[1] != null) {
    settings.program_name = path.basename(process.argv[1]);
  } else {
    settings.program_name = "unknown";
  }
  if (process.argv[1] != null) {
    settings.app_dir = path.dirname(process.argv[1]);
  } else {
    settings.app_dir = process.cwd();
  }
  if (process.env['WORK_DIR'] != null) {
    CHECK(process.env['WORK_DIR']);
  }
  if (!settings.work_dir) {
    CHECK(path.resolve("."));
  }
  if (!settings.work_dir && process.argv[1] != null) {
    CHECK(path.dirname(process.argv[1]));
  }
  if (!settings.work_dir) {
    console.error("failed to find any work directory.");
    if (process.env.VERBOSE == null) {
      console.error("please re-run the program with environment variable VERBOSE=true to get further verbose messages...");
    }
    process.exit(1);
  }
  LOAD_CONFIG = function(p, callback){
    var found, config, error;
    found = false;
    try {
      config = p.json
        ? JSON.parse(fs.readFileSync(p.path))
        : require(p.path);
      found = true;
      callback(null, config);
    } catch (e$) {
      error = e$;
      DBG("failed to load " + p.path + " due to error: " + error);
    }
    return found;
  };
  resource = {
    /**
     * Dump all enviroment variables
     */
    dumpEnvs: function(){
      var i$, ref$, len$;
      for (i$ = 0, len$ = (ref$ = process.argv).length; i$ < len$; ++i$) {
        (fn$.call(this, i$, ref$[i$]));
      }
      DBG("process.execPath = " + process.execPath);
      DBG("process.arch = " + process.arch);
      DBG("process.platform = " + process.platform);
      DBG("process.cwd() = " + process.cwd());
      DBG("path.normalize('.') = " + path.normalize('.'));
      DBG("path.normalize(__dirname) = " + path.normalize(__dirname));
      DBG("path.resolve('.') = " + path.resolve('.'));
      return DBG("path.resolve(__dirname) = " + path.resolve(__dirname));
      function fn$(i, v){
        DBG("argv[" + i + "] = " + v);
      }
    }
    /**
     * Load configuration file from following files in order
     *   - ${config_dir}/${name}.ls
     *   - ${config_dir}/${name}.js
     *   - ${config_dir}/${name}.json
     *
     * @param name, the name of configuration file to be loaded.
     */,
    loadConfig: function(name, callback){
      var pathes, ret, i$, len$, p, text, error;
      pathes = [
        {
          path: settings.config_dir + "" + path.sep + name + ".ls",
          json: false
        }, {
          path: settings.config_dir + "" + path.sep + name + ".json",
          json: true
        }
      ];
      ret = {
        found: false,
        config: null
      };
      for (i$ = 0, len$ = pathes.length; i$ < len$; ++i$) {
        p = pathes[i$];
        if (ret.found) {
          continue;
        }
        try {
          DBG("try " + p.path + " ...");
          text = fs.readFileSync(p.path) + "";
          if (!p.json) {
            text = require('livescript').compile(text, {
              json: true
            });
          }
          ret.config = JSON.parse(text);
          ret.found = true;
        } catch (e$) {
          error = e$;
          console.log("stack: " + error.stack);
          continue;
        }
      }
      if (!ret.found) {
        DBG("cannot find config " + name);
      }
      return ret.config;
    }
    /**
     * Resolve to an absolute path to the file in the specified
     * `type` directory, related to work_dir.
     *
     * @param type, the type of directory, e.g. 'logs', 'scripts', ...
     * @param filename, the name of that file.
     */,
    resolveWorkPath: function(type, filename){
      return path.resolve(settings.work_dir + "" + path.sep + type + path.sep + filename);
    }
    /**
     * Resolve to an absolute path to the file in the specified
     * `type` directory, related to app_dir.
     *
     * @param type, the type of directory, e.g. 'logs', 'scripts', ...
     * @param filename, the name of that file.
     */,
    resolveResourcePath: function(type, filename){
      var ret;
      ret = path.resolve(settings.app_dir + "" + path.sep + type + path.sep + filename);
      return ret;
    }
    /**
     * Load javascript, livescript, or coffeescript from ${app_dir}/lib. For example,
     * when `loadScript 'foo'` is called, the function tries to load scripts one-by-one
     * as following order:
     *
     *    1. ${app_dir}/lib/foo.js
     *    2. ${app_dir}/lib/foo.ls
     *
     * @name {[type]}
     */,
    loadScript: function(name){
      return require(settings.app_dir + "" + path.sep + "lib" + path.sep + name);
    }
    /**
     * Load javascript, livescript, or coffeescript from ${app_dir}/lib/plugins. For example,
     * when `loadPlugin 'foo'` is called, the function tries to load scripts one-by-one
     * as following order:
     *
     *    1. ${app_dir}/lib/plugins/foo.js
     *    2. ${app_dir}/lib/plugins/foo.ls
     *    3. ${app_dir}/lib/plugins/foo/index.js
     *    4. ${app_dir}/lib/plugins/foo/index.ls
     *    5. ${esys_modules}/base/lib/plugins/foo.js
     *    6. ${esys_modules}/base/lib/plugins/foo.ls
     *    7. ${esys_modules}/base/lib/plugins/foo/index.js
     *    8. ${esys_modules}/base/lib/plugins/foo/index.ls
     *
     * @name {[type]}
     */,
    loadPlugin: function(name){
      var lib, plugins, errors, pathes, found, m, i$, len$, exx;
      lib = 'lib';
      plugins = 'plugins';
      errors = [];
      pathes = [settings.app_dir + "" + path.sep + lib + path.sep + plugins + path.sep + name, settings.app_dir + "" + path.sep + lib + path.sep + plugins + path.sep + name + path.sep + "index", __dirname + "" + path.sep + plugins + path.sep + name, __dirname + "" + path.sep + plugins + path.sep + name + path.sep + "index"];
      found = false;
      m = null;
      for (i$ = 0, len$ = pathes.length; i$ < len$; ++i$) {
        (fn$.call(this, i$, pathes[i$]));
      }
      if (found) {
        return m;
      }
      for (i$ = 0, len$ = errors.length; i$ < len$; ++i$) {
        (fn1$.call(this, i$, errors[i$]));
      }
      exx = errors.pop();
      throw exx.err;
      function fn$(i, p){
        var error, exx;
        if (!found) {
          try {
            m = require(p);
            found = true;
          } catch (e$) {
            error = e$;
            exx = {
              err: error,
              path: p
            };
            errors.push(exx);
          }
        }
      }
      function fn1$(i, exx){
        DBG("loading " + exx.path + " but err: " + exx.err);
      }
    }
    /**
     * Get the program name of entry javascript (livescript) for
     * nodejs to execute.
     */,
    getProgramName: function(){
      return settings.program_name;
    },
    getAppDir: function(){
      return settings.app_dir;
    },
    getWorkDir: function(){
      return settings.work_dir;
    }
  };
  module.exports = exports = resource;
}).call(this);

}).call(this,"/Users/yagamy/Work/workspaces/t2t/sandbox/externals/testbox/sensor-web-exp1/modules/yapps/lib")

},{"async":"async","fs":undefined,"livescript":"livescript","path":undefined}],10:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var moment, DBG, timerCbCurrying, exports, Timer;
  moment = require('moment');
  DBG = function(){
    if (global.logger != null) {
      return global.logger.debug.apply(global.logger, arguments);
    } else {
      return console.log.apply(console.log, arguments);
    }
  };
  /**
   * Simple Usage for Timer class
  
      t = new Timer 10s, obj, func
      t = new Timer 10s, obj, func, args
      t = new Timer 10s, func
      t = new Timer 10s, func, args
  
      t.start!
      t.configure 5s
  
      t.stop!
      t.cleanup!
   *
   */
  timerCbCurrying = curry$(function(timer, dummy){
    return timer.check();
  });
  module.exports = exports = Timer = (function(){
    Timer.displayName = 'Timer';
    var prototype = Timer.prototype, constructor = Timer;
    function Timer(period, x, y, z){
      var type;
      this.period = period;
      DBG("initiate timer w/ period = " + period);
      this.args = [];
      this.obj = null;
      this.interval_obj = null;
      this.last_invocation = null;
      this.callback = timerCbCurrying(this);
      type = typeof x;
      if ("function" === type) {
        this.type = "contextless";
        this.func = x;
        if (y != null && "array" === typeof y) {
          this.args = y;
        }
      } else if ("object" === typeof x && "string" === typeof y) {
        this.type = "context";
        this.obj = x;
        this.func = x[y];
        if (z != null && "array" === typeof z) {
          this.args = z;
        }
        if (this.func == null) {
          throw new Error("function " + y + " not found");
        }
      } else {
        throw new Error("invalid arguments for timer creation");
      }
      this.running = false;
      this.interval_obj = setInterval(this.callback, 500);
      this.last_invocation = moment();
    }
    prototype.start = function(){
      return this.running = true;
    };
    prototype.stop = function(){
      return this.running = false;
    };
    prototype.cleanup = function(){
      this.running = false;
      return clearInterval(this.interval_obj);
    };
    prototype.configure = function(period){
      this.period = period;
    };
    prototype.getPeriod = function(){
      return this.period;
    };
    prototype.check = function(){
      var now;
      if (!this.running) {
        return;
      }
      now = moment();
      now.subtract(this.period, 'seconds');
      if (now > this.last_invocation) {
        this.func.apply(this.obj, this.args);
        return this.last_invocation = moment();
      }
    };
    return Timer;
  }());
  function curry$(f, bound){
    var context,
    _curry = function(args) {
      return f.length > 1 ? function(){
        var params = args ? args.concat() : [];
        context = bound ? context || this : this;
        return params.push.apply(params, arguments) <
            f.length && arguments.length ?
          _curry.call(context, params) : f.apply(context, params);
      } : f;
    };
    return _curry();
  }
}).call(this);

},{"moment":"moment"}],11:[function(require,module,exports){
// Generated by LiveScript 1.4.0
(function(){
  var mkdirp, async, util, exports;
  mkdirp = require('mkdirp');
  async = require('async');
  util = {
    createDirectories: function(dirs, callback){
      var funcs, createCurrying, i$, len$;
      funcs = [];
      createCurrying = curry$(function(dir, cb){
        DBG("creating " + dir + " ...");
        return mkdirp(dir, function(err){
          return cb(err);
        });
      });
      for (i$ = 0, len$ = dirs.length; i$ < len$; ++i$) {
        (fn$.call(this, i$, dirs[i$]));
      }
      return async.series(funcs, function(err, results){
        return callback(err);
      });
      function fn$(i, dir){
        var c;
        c = createCurrying(dir);
        funcs.push(c);
      }
    },
    copyObject: function(dst, src, fields){
      var i$, len$;
      for (i$ = 0, len$ = fields.length; i$ < len$; ++i$) {
        (fn$.call(this, i$, fields[i$]));
      }
      return dst;
      function fn$(i, f){
        if (src[f] != null) {
          dst[f] = src[f];
        }
      }
    }
  };
  module.exports = exports = util;
  function curry$(f, bound){
    var context,
    _curry = function(args) {
      return f.length > 1 ? function(){
        var params = args ? args.concat() : [];
        context = bound ? context || this : this;
        return params.push.apply(params, arguments) <
            f.length && arguments.length ?
          _curry.call(context, params) : f.apply(context, params);
      } : f;
    };
    return _curry();
  }
}).call(this);

},{"async":"async","mkdirp":"mkdirp"}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImFwcC5qcyIsIi4uL21vZHVsZXMveS13ZWIvVXNlcnMveWFnYW15L1dvcmsvd29ya3NwYWNlcy90MnQvc2FuZGJveC9leHRlcm5hbHMvdGVzdGJveC9zZW5zb3Itd2ViLWV4cDEvbW9kdWxlcy95LXdlYi9pbmRleC5qcyIsIi4uL21vZHVsZXMveS13ZWIvbGl2ZXNjcmlwdC1taWRkbGV3YXJlLmpzIiwiLi4vbW9kdWxlcy95LXdlYmFwaS1zdGQveS13ZWJhcGktc3RkLmpzIiwiLi4vbW9kdWxlcy95YXBwcy9pbmRleC5qcyIsIi4uL21vZHVsZXMveWFwcHMvbGliL2FwcHMvQmFzZUFwcC5qcyIsIi4uL21vZHVsZXMveWFwcHMvbGliL2FwcHMvV2ViQXBwLmpzIiwiLi4vbW9kdWxlcy95YXBwcy9saWIvYXN5bmMtZXhlY3V0b3IuanMiLCIuLi9tb2R1bGVzL3lhcHBzL2xpYi9Vc2Vycy95YWdhbXkvV29yay93b3Jrc3BhY2VzL3QydC9zYW5kYm94L2V4dGVybmFscy90ZXN0Ym94L3NlbnNvci13ZWItZXhwMS9tb2R1bGVzL3lhcHBzL2xpYi9yZXNvdXJjZS5qcyIsIi4uL21vZHVsZXMveWFwcHMvbGliL3RpbWVyLmpzIiwiLi4vbW9kdWxlcy95YXBwcy9saWIvdXRpbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNyV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaFZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzdQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG4oZnVuY3Rpb24oKXtcbiAgdmFyIHlhcHBzLCBhcHA7XG4gIHlhcHBzID0gcmVxdWlyZSgneWFwcHMnKTtcbiAgYXBwID0geWFwcHMuY3JlYXRlQXBwKCd3ZWInLCB7XG4gICAgcGx1Z2luczogW10sXG4gICAgdmVyYm9zZTogdHJ1ZVxuICB9KTtcbiAgYXBwLmluaXQoZnVuY3Rpb24oZXJyKXtcbiAgICBpZiAoZXJyICE9IG51bGwpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJleGl0IHdpdGggZXJyOiBcIiArIGVycik7XG4gICAgfVxuICAgIGlmIChlcnIgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHByb2Nlc3MuZXhpdCgxKTtcbiAgICB9XG4gICAgcmV0dXJuIElORk8oXCJBcHAgcmVhZHkhIVwiKTtcbiAgfSk7XG59KS5jYWxsKHRoaXMpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IExpdmVTY3JpcHQgMS40LjBcbihmdW5jdGlvbigpe1xuICB2YXIgZXhwcmVzcywgaHR0cCwgZnMsIHBhdGgsIGNvbG9ycywgaGFuZGxlYmFycywgYm9keVBhcnNlciwgZXhwcmVzc0J1bnlhbkxvZ2dlciwgcmVmJCwgZWxlbUluZGV4LCBrZXlzLCBlcnJvcl9yZXNwb25zZXMsIE5BTUUsIERCR1QsIElORk8sIEVSUiwgY29tcG9zZUVycm9yLCBjb21wb3NlRGF0YSwgaW5pdGlhdGlvbiwgZGV0ZWN0Q2xpZW50SXAsIHRydXN0ZWRfaXAsIHRydXN0ZWRfaXBfb3JfdXNlciwgc2VjcmV0Q3VycnlpbmcsIFdlYlNlcnZlciwgZXhwb3J0cztcbiAgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbiAgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKTtcbiAgZnMgPSByZXF1aXJlKCdmcycpO1xuICBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuICBjb2xvcnMgPSByZXF1aXJlKCdjb2xvcnMnKTtcbiAgaGFuZGxlYmFycyA9IHJlcXVpcmUoJ2hhbmRsZWJhcnMnKTtcbiAgYm9keVBhcnNlciA9IHJlcXVpcmUoJ2JvZHktcGFyc2VyJyk7XG4gIGV4cHJlc3NCdW55YW5Mb2dnZXIgPSByZXF1aXJlKCdleHByZXNzLWJ1bnlhbi1sb2dnZXInKTtcbiAgcmVmJCA9IHJlcXVpcmUoJ3ByZWx1ZGUtbHMnKSwgZWxlbUluZGV4ID0gcmVmJC5lbGVtSW5kZXgsIGtleXMgPSByZWYkLmtleXM7XG4gIGVycm9yX3Jlc3BvbnNlcyA9IHJlcXVpcmUoX19kaXJuYW1lICsgXCIvd2ViX2Vycm9yc1wiKTtcbiAgTkFNRSA9ICd3ZWInO1xuICBEQkdUID0gbnVsbDtcbiAgSU5GTyA9IG51bGw7XG4gIEVSUiA9IG51bGw7XG4gIGNvbXBvc2VFcnJvciA9IGZ1bmN0aW9uKHJlcSwgcmVzLCBuYW1lLCBlcnIpe1xuICAgIHZhciByLCB0ZW1wbGF0ZSwgY29udGV4dCwgbXNnLCByZXN1bHQ7XG4gICAgZXJyID09IG51bGwgJiYgKGVyciA9IG51bGwpO1xuICAgIGlmIChlcnJvcl9yZXNwb25zZXNbbmFtZV0gIT0gbnVsbCkge1xuICAgICAgciA9IGVycm9yX3Jlc3BvbnNlc1tuYW1lXTtcbiAgICAgIHRlbXBsYXRlID0gaGFuZGxlYmFycy5jb21waWxlKHIubWVzc2FnZSk7XG4gICAgICBjb250ZXh0ID0ge1xuICAgICAgICBpcDogcmVxLmlwLFxuICAgICAgICBvcmlnaW5hbFVybDogcmVxLm9yaWdpbmFsVXJsLFxuICAgICAgICBlcnI6IGVyclxuICAgICAgfTtcbiAgICAgIG1zZyA9IHRlbXBsYXRlKGNvbnRleHQpO1xuICAgICAgcmVzdWx0ID0ge1xuICAgICAgICBjb2RlOiByLmNvZGUsXG4gICAgICAgIGVycm9yOiBuYW1lLFxuICAgICAgICB1cmw6IHJlcS5vcmlnaW5hbFVybCxcbiAgICAgICAgbWVzc2FnZTogbXNnXG4gICAgICB9O1xuICAgICAgRVJSKHJlcS5tZXRob2QgKyBcIiBcIiArIGNvbG9ycy55ZWxsb3cocmVxLnVybCkgKyBcIiBcIiArIGNvbG9ycy5ncmVlbihuYW1lKSArIFwiIGpzb24gPSBcIiArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoci5zdGF0dXMpLmpzb24ocmVzdWx0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgRVJSKGNvbG9ycy55ZWxsb3cocmVxLnVybCkgKyBcIiBcIiArIGNvbG9ycy5ncmVlbihuYW1lKSArIFwiIGpzb24gPSB1bmtub3duIGVycm9yXCIpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwidW5rbm93biBlcnJvcjogXCIgKyBuYW1lXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIGNvbXBvc2VEYXRhID0gZnVuY3Rpb24ocmVxLCByZXMsIGRhdGEsIGNvZGUpe1xuICAgIHZhciByZXN1bHQ7XG4gICAgY29kZSA9PSBudWxsICYmIChjb2RlID0gMjAwKTtcbiAgICByZXN1bHQgPSB7XG4gICAgICBjb2RlOiAwLFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgdXJsOiByZXEub3JpZ2luYWxVcmwsXG4gICAgICBkYXRhOiBkYXRhXG4gICAgfTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhjb2RlKS5qc29uKHJlc3VsdCk7XG4gIH07XG4gIGluaXRpYXRpb24gPSBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCl7XG4gICAgcmVxLndlYl9jb250ZXh0ID0ge307XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfTtcbiAgZGV0ZWN0Q2xpZW50SXAgPSBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCl7XG4gICAgdmFyIGlwLCB3ZWJfY29udGV4dDtcbiAgICBpcCA9IHJlcS5pcDtcbiAgICB3ZWJfY29udGV4dCA9IHJlcS53ZWJfY29udGV4dDtcbiAgICB3ZWJfY29udGV4dC50cnVzdGVkX2lwID0gZmFsc2U7XG4gICAgaWYgKGlwID09PSBcIjEyNy4wLjAuMVwiKSB7XG4gICAgICB3ZWJfY29udGV4dC50cnVzdGVkX2lwID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGlwLnN0YXJ0c1dpdGgoXCIxOTIuMTY4LlwiKSkge1xuICAgICAgd2ViX2NvbnRleHQudHJ1c3RlZF9pcCA9IHRydWU7XG4gICAgfVxuICAgIGlmICh1bmRlZmluZWQgIT09IGVsZW1JbmRleChpcCwgWycxMTguMTYzLjE0NS4yMTcnLCAnMTE4LjE2My4xNDUuMjE4JywgJzExOC4xNjMuMTQ1LjIxOScsICcxMTguMTYzLjE0NS4yMjAnLCAnMTE4LjE2My4xNDUuMjIxJywgJzExOC4xNjMuMTQ1LjIyMicsICc1OS44Ny4xMS4xNzAnXSkpIHtcbiAgICAgIHdlYl9jb250ZXh0LnRydXN0ZWRfaXAgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gbmV4dCgpO1xuICB9O1xuICB0cnVzdGVkX2lwID0gZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpe1xuICAgIGlmICghcmVxLndlYl9jb250ZXh0LnRydXN0ZWRfaXApIHtcbiAgICAgIHJldHVybiBjb21wb3NlRXJyb3IocmVxLCByZXMsICd1bnRydXN0ZWRfaXAnKTtcbiAgICB9XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfTtcbiAgdHJ1c3RlZF9pcF9vcl91c2VyID0gZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpe1xuICAgIHJlcS51c2VyID0ge1xuICAgICAgbmFtZTogJ2xvY2FsaG9zdCdcbiAgICB9O1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH07XG4gIHNlY3JldEN1cnJ5aW5nID0gY3VycnkkKGZ1bmN0aW9uKHdlYnNlcnZlciwgbmFtZSwgcGFzc3dvcmQsIGRvbmUpe1xuICAgIHJldHVybiB3ZWJzZXJ2ZXIuc2VjcmV0Q2hlY2sobmFtZSwgcGFzc3dvcmQsIGRvbmUpO1xuICB9KTtcbiAgV2ViU2VydmVyID0gKGZ1bmN0aW9uKCl7XG4gICAgV2ViU2VydmVyLmRpc3BsYXlOYW1lID0gJ1dlYlNlcnZlcic7XG4gICAgdmFyIHByb3RvdHlwZSA9IFdlYlNlcnZlci5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gV2ViU2VydmVyO1xuICAgIGZ1bmN0aW9uIFdlYlNlcnZlcihvcHRzLCBhcHApe1xuICAgICAgdmFyIHJlZiQsIHJlc291cmNlLCB1dGlsLCBmaWVsZHM7XG4gICAgICB0aGlzLm9wdHMgPSBvcHRzO1xuICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgICBEQkdUKFwiaW5pdGlhdGVcIik7XG4gICAgICB0aGlzLndlYiA9IG51bGw7XG4gICAgICB0aGlzLnJvdXRlcyA9IHt9O1xuICAgICAgdGhpcy5hcGlfcm91dGVzID0ge307XG4gICAgICB0aGlzLndzcyA9IHt9O1xuICAgICAgdGhpcy5zeXNfaGVscGVycyA9IHRoaXMub3B0cy5oZWxwZXJzO1xuICAgICAgcmVmJCA9IHRoaXMuc3lzX2hlbHBlcnMsIHJlc291cmNlID0gcmVmJC5yZXNvdXJjZSwgdXRpbCA9IHJlZiQudXRpbDtcbiAgICAgIHRoaXMuaGVscGVycyA9IHtcbiAgICAgICAgY29tcG9zZUVycm9yOiBjb21wb3NlRXJyb3IsXG4gICAgICAgIGNvbXBvc2VEYXRhOiBjb21wb3NlRGF0YSxcbiAgICAgICAgdHJ1c3RlZF9pcDogdHJ1c3RlZF9pcCxcbiAgICAgICAgdHJ1c3RlZF9pcF9vcl91c2VyOiB0cnVzdGVkX2lwX29yX3VzZXJcbiAgICAgIH07XG4gICAgICB0aGlzLl9vcHRzID0ge1xuICAgICAgICB1cGxvYWRfcGF0aDogcmVzb3VyY2UucmVzb2x2ZVdvcmtQYXRoKCd3b3JrJywgJ3dlYi91cGxvYWQnKSxcbiAgICAgICAgcG9ydDogNjAxMCxcbiAgICAgICAgaG9zdDogJzAuMC4wLjAnLFxuICAgICAgICBoZWFkbGVzczogdHJ1ZSxcbiAgICAgICAgdmlld192ZXJib3NlOiBmYWxzZSxcbiAgICAgICAgYXBpOiAxLFxuICAgICAgICBleHByZXNzX3BhcnRpYWxfcmVzcG9uc2U6IHRydWUsXG4gICAgICAgIGV4cHJlc3NfbWV0aG9kX292ZXJyaWQ6IHRydWUsXG4gICAgICAgIGV4cHJlc3NfbXVsdGVyOiB0cnVlXG4gICAgICB9O1xuICAgICAgZmllbGRzID0ga2V5cyh0aGlzLl9vcHRzKTtcbiAgICAgIHRoaXMuX29wdHMgPSB1dGlsLmNvcHlPYmplY3QodGhpcy5fb3B0cywgdGhpcy5vcHRzLCBmaWVsZHMpO1xuICAgICAgaWYgKCF0aGlzLl9vcHRzLmhlYWRsZXNzKSB7XG4gICAgICAgIHRoaXMuX29wdHMuanNfZGVzdF9wYXRoID0gcmVzb3VyY2UucmVzb2x2ZVdvcmtQYXRoKCd3b3JrJywgJ3dlYi9kZXN0Jyk7XG4gICAgICB9XG4gICAgfVxuICAgIHByb3RvdHlwZS5pbml0aWF0ZUxvZ2dlciA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgbG9nZ2VyLCB3ZWJNaWRkbGV3YXJlO1xuICAgICAgbG9nZ2VyID0gdGhpcy5zeXNfaGVscGVycy5sb2dnZXI7XG4gICAgICB3ZWJNaWRkbGV3YXJlID0gZXhwcmVzc0J1bnlhbkxvZ2dlcih7XG4gICAgICAgIGxvZ2dlcjogbG9nZ2VyLFxuICAgICAgICBpbW1lZGlhdGU6IGZhbHNlLFxuICAgICAgICBsZXZlbEZuOiBmdW5jdGlvbihzdGF0dXMsIGVycil7XG4gICAgICAgICAgaWYgKDIwMCA9PT0gc3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RlYnVnJztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKDIwMSA9PT0gc3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RlYnVnJztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHN0YXR1cyA+PSAzMDAgJiYgc3RhdHVzIDwgNDAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RlYnVnJztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHN0YXR1cyA+PSA0MDAgJiYgc3RhdHVzIDwgNTAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2luZm8nO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3RhdHVzID49IDUwMCkge1xuICAgICAgICAgICAgcmV0dXJuICdlcnJvcic7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAnd2Fybic7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXMud2ViLnVzZSh3ZWJNaWRkbGV3YXJlKTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5pbml0aWF0ZVZpZXcgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIHdlYiwgX29wdHMsIHJlc291cmNlLCBqc19wYXRoLCBpbWdfcGF0aCwgY3NzX3BhdGgsIGphZGVfcGF0aCwgZmF2aWNvbl9wYXRoLCBsaXZlc2NyaXB0X3BhdGgsIGpzX2Rlc3RfcGF0aCwgamFkZSwgc2VydmVGYXZpY29uLCBsaXZlc2NyaXB0TWlkZGxld2FyZSwgY29tcGlsZTtcbiAgICAgIGlmICh0aGlzLl9vcHRzLmhlYWRsZXNzKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHdlYiA9IHRoaXMud2ViLCBfb3B0cyA9IHRoaXMuX29wdHM7XG4gICAgICByZXNvdXJjZSA9IHRoaXMuc3lzX2hlbHBlcnMucmVzb3VyY2U7XG4gICAgICBqc19wYXRoID0gcmVzb3VyY2UucmVzb2x2ZVJlc291cmNlUGF0aCgnYXNzZXRzJywgJ2pzJyk7XG4gICAgICBpbWdfcGF0aCA9IHJlc291cmNlLnJlc29sdmVSZXNvdXJjZVBhdGgoJ2Fzc2V0cycsICdpbWcnKTtcbiAgICAgIGNzc19wYXRoID0gcmVzb3VyY2UucmVzb2x2ZVJlc291cmNlUGF0aCgnYXNzZXRzJywgJ2NzcycpO1xuICAgICAgamFkZV9wYXRoID0gcmVzb3VyY2UucmVzb2x2ZVJlc291cmNlUGF0aCgnYXNzZXRzJywgJ3ZpZXdzJyk7XG4gICAgICBmYXZpY29uX3BhdGggPSByZXNvdXJjZS5yZXNvbHZlUmVzb3VyY2VQYXRoKCdhc3NldHMnLCAnaW1nL2Zhdmljb24uaWNvJyk7XG4gICAgICBsaXZlc2NyaXB0X3BhdGggPSByZXNvdXJjZS5yZXNvbHZlUmVzb3VyY2VQYXRoKCdhc3NldHMnLCAnbHMnKTtcbiAgICAgIGpzX2Rlc3RfcGF0aCA9IF9vcHRzLmpzX2Rlc3RfcGF0aDtcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKGphZGVfcGF0aCkpIHtcbiAgICAgICAgamFkZSA9IHJlcXVpcmUoJ2phZGUnKTtcbiAgICAgICAgSU5GTyhcInNldCB2aWV3IGVuZ2luZTogamFkZSAoXCIgKyBqYWRlX3BhdGguY3lhbiArIFwiKVwiKTtcbiAgICAgICAgd2ViLnNldCgndmlld3MnLCBqYWRlX3BhdGgpO1xuICAgICAgICB3ZWIuc2V0KCd2aWV3IGVuZ2luZScsICdqYWRlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBEQkcoXCJubyB2aWV3IGVuZ2luZSAodGhlIHRlbXBsYXRlIGRpcmVjdG9yeSBcIiArIGphZGVfcGF0aC5jeWFuICsgXCIgZG9lcyBub3QgZXhpc3QpXCIpO1xuICAgICAgfVxuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZmF2aWNvbl9wYXRoKSkge1xuICAgICAgICBzZXJ2ZUZhdmljb24gPSByZXF1aXJlKCdzZXJ2ZS1mYXZpY29uJyk7XG4gICAgICAgIHdlYi51c2Uoc2VydmVGYXZpY29uKGZhdmljb25fcGF0aCkpO1xuICAgICAgICBJTkZPKFwic2V0IGZhdmljb24gKFwiICsgZmF2aWNvbl9wYXRoLmN5YW4gKyBcIilcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBEQkcoXCJubyBmYXZpY29uICh0aGUgaWNvbiBkaXJlY3RvcnkgXCIgKyBmYXZpY29uX3BhdGguY3lhbiArIFwiIGRvZXMgbm90IGV4aXN0KVwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKGltZ19wYXRoKSkge1xuICAgICAgICB3ZWIudXNlKCcvaW1nJywgZXhwcmVzc1snc3RhdGljJ10oaW1nX3BhdGgpKTtcbiAgICAgICAgSU5GTyhcImFkZCAvaW1nXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgREJHKFwibm8gL2ltZyAoXCIgKyBpbWdfcGF0aC5jeWFuICsgXCIgZG9lcyBub3QgZXhpc3QpXCIpO1xuICAgICAgfVxuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoY3NzX3BhdGgpKSB7XG4gICAgICAgIHdlYi51c2UoJy9jc3MnLCBleHByZXNzWydzdGF0aWMnXShjc3NfcGF0aCkpO1xuICAgICAgICBJTkZPKFwiYWRkIC9jc3NcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBEQkcoXCJubyAvY3NzIChcIiArIGNzc19wYXRoLmN5YW4gKyBcIiBkb2VzIG5vdCBleGlzdClcIik7XG4gICAgICB9XG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhsaXZlc2NyaXB0X3BhdGgpKSB7XG4gICAgICAgIGxpdmVzY3JpcHRNaWRkbGV3YXJlID0gcmVxdWlyZSgnLi9saXZlc2NyaXB0LW1pZGRsZXdhcmUnKTtcbiAgICAgICAgY29tcGlsZSA9IGxpdmVzY3JpcHRNaWRkbGV3YXJlKHtcbiAgICAgICAgICBzcmM6IGxpdmVzY3JpcHRfcGF0aCxcbiAgICAgICAgICBkZXN0OiBqc19kZXN0X3BhdGhcbiAgICAgICAgfSk7XG4gICAgICAgIHdlYi51c2UoJy9qcycsIGNvbXBpbGUsIGV4cHJlc3NbJ3N0YXRpYyddKGpzX2Rlc3RfcGF0aCkpO1xuICAgICAgICBJTkZPKFwiYWRkIC9qcyAod2l0aCBsaXZlc2NyaXB0LW1pZGRsZXdhcmUpXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgREJHKFwibm8gY29tcGlsZWQgL2pzIChcIiArIGxpdmVzY3JpcHRfcGF0aC5jeWFuICsgXCIgZG9lcyBub3QgZXhpc3QpXCIpO1xuICAgICAgfVxuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoanNfcGF0aCkpIHtcbiAgICAgICAgd2ViLnVzZSgnL2pzJywgZXhwcmVzc1snc3RhdGljJ10oanNfcGF0aCkpO1xuICAgICAgICByZXR1cm4gSU5GTyhcImFkZCAvanNcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gREJHKFwibm8gcmF3IC9qcyAoXCIgKyBqc19wYXRoLmN5YW4gKyBcIiBkb2VzIG5vdCBleGlzdClcIik7XG4gICAgICB9XG4gICAgfTtcbiAgICBwcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihkb25lKXtcbiAgICAgIHZhciByZXNvdXJjZSwgcmVmJCwgcG9ydCwgaG9zdCwgdXBsb2FkX3BhdGgsIHdlYiwgbXVsdGVyLCBtZXRob2RPdmVycmlkZSwgamFkZV9wYXRoLCBpJCwgcG9pbnQsIHYsIG0sIGFwaSwgc2lvO1xuICAgICAgREJHVChcInByZXBhcmluZyBtaWRkbGV3YXJlcyAuLi5cIik7XG4gICAgICByZXNvdXJjZSA9IHRoaXMuc3lzX2hlbHBlcnMucmVzb3VyY2U7XG4gICAgICByZWYkID0gdGhpcy5fb3B0cywgcG9ydCA9IHJlZiQucG9ydCwgaG9zdCA9IHJlZiQuaG9zdCwgdXBsb2FkX3BhdGggPSByZWYkLnVwbG9hZF9wYXRoO1xuICAgICAgdGhpcy53ZWIgPSB3ZWIgPSBleHByZXNzKCk7XG4gICAgICB0aGlzLnNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKHRoaXMud2ViKTtcbiAgICAgIHdlYi5zZXQoJ3RydXN0IHByb3h5JywgdHJ1ZSk7XG4gICAgICB3ZWIudXNlKGJvZHlQYXJzZXIuanNvbigpKTtcbiAgICAgIHdlYi51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHtcbiAgICAgICAgZXh0ZW5kZWQ6IHRydWVcbiAgICAgIH0pKTtcbiAgICAgIERCR1QoXCJ1c2UgbWlkZGxld2FyZTogYm9keS1wYXJzZXJcIik7XG4gICAgICBpZiAodGhpcy5fb3B0cy5leHByZXNzX211bHRlcikge1xuICAgICAgICBtdWx0ZXIgPSByZXF1aXJlKCdtdWx0ZXInKTtcbiAgICAgICAgd2ViLnVzZShtdWx0ZXIoe1xuICAgICAgICAgIGRlc3Q6IHVwbG9hZF9wYXRoXG4gICAgICAgIH0pKTtcbiAgICAgICAgREJHVChcInVzZSBtaWRkbGV3YXJlOiBtdWx0ZXJcIik7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fb3B0cy5leHByZXNzX21ldGhvZF9vdmVycmlkKSB7XG4gICAgICAgIG1ldGhvZE92ZXJyaWRlID0gcmVxdWlyZSgnbWV0aG9kLW92ZXJyaWRlJyk7XG4gICAgICAgIHdlYi51c2UobWV0aG9kT3ZlcnJpZGUoKSk7XG4gICAgICAgIERCR1QoXCJ1c2UgbWlkZGxld2FyZTogbWV0aG9kLW92ZXJyaWRlXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX29wdHMudmlld192ZXJib3NlKSB7XG4gICAgICAgIHRoaXMuaW5pdGlhdGVMb2dnZXIoKTtcbiAgICAgICAgdGhpcy5pbml0aWF0ZVZpZXcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaW5pdGlhdGVWaWV3KCk7XG4gICAgICAgIHRoaXMuaW5pdGlhdGVMb2dnZXIoKTtcbiAgICAgIH1cbiAgICAgIHdlYi51c2UoaW5pdGlhdGlvbik7XG4gICAgICB3ZWIudXNlKGRldGVjdENsaWVudElwKTtcbiAgICAgIGphZGVfcGF0aCA9IHdlYi5nZXQoJ3ZpZXdzJyk7XG4gICAgICBmb3IgKGkkIGluIHJlZiQgPSB0aGlzLnJvdXRlcykge1xuICAgICAgICAoZm4kLmNhbGwodGhpcywgaSQsIHJlZiRbaSRdKSk7XG4gICAgICB9XG4gICAgICBwb2ludCA9IFwiL2FwaS92XCIgKyB0aGlzLl9vcHRzLmFwaSArIFwiL1wiO1xuICAgICAgdiA9IHRoaXMuYXBpX3YgPSBuZXcgZXhwcmVzcygpO1xuICAgICAgaWYgKHRoaXMuX29wdHMuZXhwcmVzc19wYXJ0aWFsX3Jlc3BvbnNlKSB7XG4gICAgICAgIG0gPSByZXF1aXJlKCdleHByZXNzLXBhcnRpYWwtcmVzcG9uc2UnKTtcbiAgICAgICAgdi51c2UobSgpKTtcbiAgICAgIH1cbiAgICAgIElORk8oXCJ1c2luZyBcIiArIHBvaW50ICsgXCIgKHBhcnRpYWwtcmVzcG9uc2U6IFwiICsgdGhpcy5fb3B0cy5leHByZXNzX3BhcnRpYWxfcmVzcG9uc2UgKyBcIilcIik7XG4gICAgICBmb3IgKGkkIGluIHJlZiQgPSB0aGlzLmFwaV9yb3V0ZXMpIHtcbiAgICAgICAgKGZuMSQuY2FsbCh0aGlzLCBpJCwgcmVmJFtpJF0pKTtcbiAgICAgIH1cbiAgICAgIGFwaSA9IHRoaXMuYXBpID0gbmV3IGV4cHJlc3MoKTtcbiAgICAgIGFwaS51c2UoXCIvdlwiICsgdGhpcy5fb3B0cy5hcGksIHYpO1xuICAgICAgd2ViLnVzZShcIi9hcGlcIiwgYXBpKTtcbiAgICAgIHNpbyA9IHJlcXVpcmUoJ3NvY2tldC5pbycpO1xuICAgICAgdGhpcy5pbyA9IHNpbyh0aGlzLnNlcnZlcik7XG4gICAgICB0aGlzLnNlcnZlci5vbignbGlzdGVuaW5nJywgZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHA7XG4gICAgICAgIHAgPSBwb3J0ICsgXCJcIjtcbiAgICAgICAgSU5GTyhcImxpc3RlbmluZyBcIiArIGhvc3QueWVsbG93ICsgXCI6XCIgKyBwLmN5YW4pO1xuICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgfSk7XG4gICAgICBmb3IgKGkkIGluIHJlZiQgPSB0aGlzLndzcykge1xuICAgICAgICAoZm4yJC5jYWxsKHRoaXMsIGkkLCByZWYkW2kkXSkpO1xuICAgICAgfVxuICAgICAgREJHVChcInN0YXJ0aW5nIHdlYiBzZXJ2ZXIgLi4uXCIpO1xuICAgICAgcmV0dXJuIHRoaXMuc2VydmVyLmxpc3Rlbihwb3J0LCBob3N0KTtcbiAgICAgIGZ1bmN0aW9uIGZuJChuYW1lLCBtaWRkbGV3YXJlKXtcbiAgICAgICAgd2ViLnVzZShcIi9cIiArIG5hbWUsIG1pZGRsZXdhcmUpO1xuICAgICAgICBJTkZPKFwiYWRkIC9cIiArIG5hbWUpO1xuICAgICAgICBpZiAoamFkZV9wYXRoICE9IG51bGwpIHtcbiAgICAgICAgICBtaWRkbGV3YXJlLnNldCgndmlld3MnLCBqYWRlX3BhdGgpO1xuICAgICAgICAgIG1pZGRsZXdhcmUuc2V0KCd2aWV3IGVuZ2luZScsICdqYWRlJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGZuMSQobmFtZSwgbWlkZGxld2FyZSl7XG4gICAgICAgIHYudXNlKFwiL1wiICsgbmFtZSwgbWlkZGxld2FyZSk7XG4gICAgICAgIElORk8oXCJhZGQgXCIgKyBwb2ludCArIG5hbWUpO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZm4yJChuYW1lLCBoYW5kbGVyKXtcbiAgICAgICAgdmFyIHM7XG4gICAgICAgIHMgPSB0aGlzLmlvLm9mKG5hbWUpO1xuICAgICAgICBzLm9uKCdjb25uZWN0aW9uJywgaGFuZGxlcik7XG4gICAgICAgIElORk8oXCJhZGQgaGFuZGxlciBmb3Igd3M6Ly9sb2NhbGhvc3QvXCIgKyBuYW1lKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHByb3RvdHlwZS51c2UgPSBmdW5jdGlvbihuYW1lLCBtaWRkbGV3YXJlKXtcbiAgICAgIGlmICh0aGlzLndlYiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvdXRlc1tuYW1lXSA9IG1pZGRsZXdhcmU7XG4gICAgICB9XG4gICAgfTtcbiAgICBwcm90b3R5cGUudXNlQXBpID0gZnVuY3Rpb24obmFtZSwgbWlkZGxld2FyZSl7XG4gICAgICBpZiAodGhpcy53ZWIgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hcGlfcm91dGVzW25hbWVdID0gbWlkZGxld2FyZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHByb3RvdHlwZS51c2VXcyA9IGZ1bmN0aW9uKG5hbWUsIGhhbmRsZXIpe1xuICAgICAgaWYgKHRoaXMud2ViID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud3NzW25hbWVdID0gaGFuZGxlcjtcbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBXZWJTZXJ2ZXI7XG4gIH0oKSk7XG4gIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IHtcbiAgICBuYW1lOiBOQU1FLFxuICAgIGF0dGFjaDogZnVuY3Rpb24ob3B0cyl7XG4gICAgICBtb2R1bGUubG9nZ2VyID0gb3B0cy5oZWxwZXJzLmxvZ2dlcjtcbiAgICAgIERCR1QgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gbW9kdWxlLmxvZ2dlci5kZWJ1Zy5hcHBseShtb2R1bGUubG9nZ2VyLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICAgIElORk8gPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gbW9kdWxlLmxvZ2dlci5pbmZvLmFwcGx5KG1vZHVsZS5sb2dnZXIsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgICAgRVJSID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIG1vZHVsZS5sb2dnZXIuZXJyb3IuYXBwbHkobW9kdWxlLmxvZ2dlciwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gdGhpcy53ZWIgPSBuZXcgV2ViU2VydmVyKG9wdHMsIHRoaXMpO1xuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24oZG9uZSl7XG4gICAgICB2YXIgd2ViLCB1dGlsLCBfb3B0cywgZGlycztcbiAgICAgIHdlYiA9IHRoaXMud2ViO1xuICAgICAgdXRpbCA9IHdlYi5zeXNfaGVscGVycy51dGlsO1xuICAgICAgX29wdHMgPSB3ZWIuX29wdHM7XG4gICAgICBkaXJzID0gW19vcHRzLnVwbG9hZF9wYXRoXTtcbiAgICAgIGlmICghX29wdHMuaGVhZGxlc3MpIHtcbiAgICAgICAgZGlycy5wdXNoKF9vcHRzLmpzX2Rlc3RfcGF0aCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdXRpbC5jcmVhdGVEaXJlY3RvcmllcyhkaXJzLCBmdW5jdGlvbihlcnIpe1xuICAgICAgICByZXR1cm4gZG9uZShlcnIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuICBmdW5jdGlvbiBjdXJyeSQoZiwgYm91bmQpe1xuICAgIHZhciBjb250ZXh0LFxuICAgIF9jdXJyeSA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgIHJldHVybiBmLmxlbmd0aCA+IDEgPyBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgcGFyYW1zID0gYXJncyA/IGFyZ3MuY29uY2F0KCkgOiBbXTtcbiAgICAgICAgY29udGV4dCA9IGJvdW5kID8gY29udGV4dCB8fCB0aGlzIDogdGhpcztcbiAgICAgICAgcmV0dXJuIHBhcmFtcy5wdXNoLmFwcGx5KHBhcmFtcywgYXJndW1lbnRzKSA8XG4gICAgICAgICAgICBmLmxlbmd0aCAmJiBhcmd1bWVudHMubGVuZ3RoID9cbiAgICAgICAgICBfY3VycnkuY2FsbChjb250ZXh0LCBwYXJhbXMpIDogZi5hcHBseShjb250ZXh0LCBwYXJhbXMpO1xuICAgICAgfSA6IGY7XG4gICAgfTtcbiAgICByZXR1cm4gX2N1cnJ5KCk7XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgTGl2ZVNjcmlwdCAxLjQuMFxuLypcbiAqIExpdmVzY3JpcHQgbWlkZGxld2FyZVxuICogY29waWVkIGZyb20gU3R5bHVzIG1pZGRsZXdhcmVcbiAqL1xuKGZ1bmN0aW9uKCl7XG4gIC8qKlxuICAgKiBNb2R1bGUgZGVwZW5kZW5jaWVzLlxuICAgKi9cbiAgLypcbiAgcmVxdWlyZSEge1xuICAgICd1Z2xpZnktanMnOiB7bWluaWZ5fVxuICAgIExpdmVTY3JpcHQ6IGxpdmVzY3JpcHRcbiAgXG4gICAgZnNcbiAgICB1cmxcbiAgICBwYXRoOiB7am9pbiwgc2VwLCBkaXJuYW1lfVxuICAgIG1rZGlycFxuICB9XG4gICovXG4gIHZhciBtaW5pZnksIGxpdmVzY3JpcHQsIGZzLCB1cmwsIG1rZGlycCwgcGF0aCwgam9pbiwgc2VwLCBkaXJuYW1lLCBkZWZhdWx0cztcbiAgbWluaWZ5ID0gcmVxdWlyZSgndWdsaWZ5LWpzJykubWluaWZ5O1xuICBsaXZlc2NyaXB0ID0gcmVxdWlyZSgnbGl2ZXNjcmlwdCcpO1xuICBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG4gIHVybCA9IHJlcXVpcmUoJ3VybCcpO1xuICBta2RpcnAgPSByZXF1aXJlKCdta2RpcnAnKTtcbiAgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbiAgam9pbiA9IHBhdGguam9pbiwgc2VwID0gcGF0aC5zZXAsIGRpcm5hbWUgPSBwYXRoLmRpcm5hbWU7XG4gIGRlZmF1bHRzID0ge1xuICAgIGNvbXByZXNzOiBmYWxzZVxuICB9O1xuICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHZhciBkZXN0LCBzcmM7XG4gICAgb3B0aW9ucyA9PSBudWxsICYmIChvcHRpb25zID0ge30pO1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIHNyYzogb3B0aW9uc1xuICAgICAgfTtcbiAgICB9XG4gICAgb3B0aW9ucyA9IGltcG9ydCQoZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgIGRlc3QgPSBvcHRpb25zLmRlc3QsIHNyYyA9IG9wdGlvbnMuc3JjO1xuICAgIGlmIChzcmMgPT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdsaXZlc2NyaXB0Lm1pZGRsZXdhcmUoKSByZXF1aXJlcyBcInNyY1wiIGRpcmVjdG9yeScpO1xuICAgIH1cbiAgICBkZXN0IHx8IChkZXN0ID0gc3JjKTtcbiAgICBvcHRpb25zLmNvbXBpbGUgfHwgKG9wdGlvbnMuY29tcGlsZSA9IGZ1bmN0aW9uKHN0ciwgcGF0aCl7XG4gICAgICByZXR1cm4gbGl2ZXNjcmlwdC5jb21waWxlKHN0ciwge1xuICAgICAgICBiYXJlOiBvcHRpb25zLmJhcmVcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCl7XG4gICAgICB2YXIgcGF0aCwgb3ZlcmxhcCwganNQYXRoLCBsc1BhdGgsIGVycm9yO1xuICAgICAgaWYgKCFhcnJheUNvbnRhaW5zKFsnR0VUJywgJ0hFQUQnXSwgcmVxLm1ldGhvZCkpIHtcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH1cbiAgICAgIHBhdGggPSB1cmwucGFyc2UocmVxLnVybCkucGF0aG5hbWU7XG4gICAgICBpZiAoIS9cXC5qcyQvLnRlc3QocGF0aCkpIHtcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChhcnJheUNvbnRhaW5zKFsnc3RyaW5nJywgJ2Z1bmN0aW9uJ10sIHR5cGVvZiBkZXN0KSkge1xuICAgICAgICBvdmVybGFwID0gY29tcGFyZSh0eXBlb2YgZGVzdCA9PT0gJ2Z1bmN0aW9uJyA/IGRlc3QocGF0aCkgOiBkZXN0LCBwYXRoKTtcbiAgICAgICAgcGF0aCA9IHBhdGguc2xpY2Uob3ZlcmxhcC5sZW5ndGgpO1xuICAgICAgfVxuICAgICAganNQYXRoID0gdHlwZW9mIGRlc3QgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBkZXN0KHBhdGgpXG4gICAgICAgIDogam9pbihkZXN0LCBwYXRoKTtcbiAgICAgIGxzUGF0aCA9IHR5cGVvZiBzcmMgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBzcmMocGF0aClcbiAgICAgICAgOiBqb2luKHNyYywgcGF0aC5yZXBsYWNlKCcuanMnLCAnLmxzJykpO1xuICAgICAgZXJyb3IgPSBmdW5jdGlvbihlcnIpe1xuICAgICAgICByZXR1cm4gbmV4dChlcnIuY29kZSA9PT0gJ0VOT0VOVCcgPyBudWxsIDogZXJyKTtcbiAgICAgIH07XG4gICAgICBpZiAob3B0aW9ucy5mb3JjZSkge1xuICAgICAgICByZXR1cm4gY29tcGlsZSgpO1xuICAgICAgfVxuICAgICAgZnMuc3RhdChsc1BhdGgsIGZ1bmN0aW9uKGVyciwgbHNTdGF0cyl7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gZXJyb3IoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnMuc3RhdChqc1BhdGgsIGZ1bmN0aW9uKGVyciwganNTdGF0cyl7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgaWYgKGVyci5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICAgICAgICByZXR1cm4gY29tcGlsZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGxzU3RhdHMubXRpbWUgPiBqc1N0YXRzLm10aW1lKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjb21waWxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGZ1bmN0aW9uIGNvbXBpbGUoKXtcbiAgICAgICAgcmV0dXJuIGZzLnJlYWRGaWxlKGxzUGF0aCwgJ3V0ZjgnLCBmdW5jdGlvbihlcnIsIHN0cil7XG4gICAgICAgICAgdmFyIGpzO1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvcihlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAganMgPSBvcHRpb25zLmNvbXBpbGUoc3RyLCB7fSk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5jb21wcmVzcykge1xuICAgICAgICAgICAgICBqcyA9IG1pbmlmeShqcywge1xuICAgICAgICAgICAgICAgIGZyb21TdHJpbmc6IHRydWVcbiAgICAgICAgICAgICAgfSkuY29kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBta2RpcnAoZGlybmFtZShqc1BhdGgpLCA0NDgsIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gZnMud3JpdGVGaWxlKGpzUGF0aCwganMsICd1dGY4JywgbmV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGNhdGNoIChlJCkge1xuICAgICAgICAgICAgZXJyID0gZSQ7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3IoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbXBpbGU7XG4gICAgfTtcbiAgfTtcbiAgZnVuY3Rpb24gYXJyYXlDb250YWlucyhoYXlzdGFjaywgbmVlZGxlKXtcbiAgICByZXR1cm4gLTEgIT09IGhheXN0YWNrLmluZGV4T2YobmVlZGxlKTtcbiAgfVxuICAvKipcbiAgICogZ2V0IHRoZSBvdmVybGFwcGluZyBwYXRoIGZyb20gdGhlIGVuZCBvZiBwYXRoIEEsIGFuZCB0aGUgYmVnaW5pbmcgb2YgcGF0aCBCLlxuICAgKlxuICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aEFcbiAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGhCXG4gICAqIEByZXR1cm4ge1N0cmluZ31cbiAgICogQGFwaSBwcml2YXRlXG4gICAqL1xuICBmdW5jdGlvbiBjb21wYXJlKHBhdGhBLCBwYXRoQil7XG4gICAgdmFyIG92ZXJsYXA7XG4gICAgcGF0aEEgPSBwYXRoQS5zcGxpdChzZXApO1xuICAgIHBhdGhCID0gcGF0aEIuc3BsaXQoc2VwKTtcbiAgICBvdmVybGFwID0gW107XG4gICAgd2hpbGUgKHBhdGhBW3BhdGhBLmxlbmd0aCAtIDFdID09PSBwYXRoQlswXSkge1xuICAgICAgb3ZlcmxhcC5wdXNoKHBhdGhBLnBvcCgpKTtcbiAgICAgIHBhdGhCLnNoaWZ0KCk7XG4gICAgfVxuICAgIHJldHVybiBvdmVybGFwLmpvaW4oc2VwKTtcbiAgfVxuICBmdW5jdGlvbiBpbXBvcnQkKG9iaiwgc3JjKXtcbiAgICB2YXIgb3duID0ge30uaGFzT3duUHJvcGVydHk7XG4gICAgZm9yICh2YXIga2V5IGluIHNyYykgaWYgKG93bi5jYWxsKHNyYywga2V5KSkgb2JqW2tleV0gPSBzcmNba2V5XTtcbiAgICByZXR1cm4gb2JqO1xuICB9XG59KS5jYWxsKHRoaXMpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IExpdmVTY3JpcHQgMS40LjBcbihmdW5jdGlvbigpe1xuICB2YXIgZXhwcmVzcywga2V5cywgTkFNRSwgREJHVCwgZXhwb3J0cztcbiAgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbiAga2V5cyA9IHJlcXVpcmUoJ3ByZWx1ZGUtbHMnKS5rZXlzO1xuICBOQU1FID0gJ3N0ZC13ZWJhcGknO1xuICBEQkdUID0gbnVsbDtcbiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0ge1xuICAgIG5hbWU6IE5BTUUsXG4gICAgYXR0YWNoOiBmdW5jdGlvbihvcHRzKXtcbiAgICAgIG1vZHVsZS5sb2dnZXIgPSBvcHRzLmhlbHBlcnMubG9nZ2VyO1xuICAgICAgREJHVCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBtb2R1bGUubG9nZ2VyLmRlYnVnLmFwcGx5KG1vZHVsZS5sb2dnZXIsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24oZG9uZSl7XG4gICAgICB2YXIgYXBwLCB3ZWIsIHBhcmVudCwgcmVmJCwgY29tcG9zZUVycm9yLCBjb21wb3NlRGF0YSwgc3RkO1xuICAgICAgYXBwID0gdGhpcztcbiAgICAgIHdlYiA9IGFwcC53ZWIsIHBhcmVudCA9IGFwcC5wYXJlbnQ7XG4gICAgICByZWYkID0gd2ViLmhlbHBlcnMsIGNvbXBvc2VFcnJvciA9IHJlZiQuY29tcG9zZUVycm9yLCBjb21wb3NlRGF0YSA9IHJlZiQuY29tcG9zZURhdGE7XG4gICAgICBzdGQgPSBleHByZXNzKCk7XG4gICAgICBzdGQuZ2V0KCcvY29uZmlnJywgZnVuY3Rpb24ocmVxLCByZXMpe1xuICAgICAgICB2YXIgYXBpX3JvdXRlcywgd3NzLCBwbHVnaW5zLCBwbHVnaW5fbmFtZXMsIGkkLCBsZW4kLCBjb25maWc7XG4gICAgICAgIGFwaV9yb3V0ZXMgPSB3ZWIuYXBpX3JvdXRlcywgd3NzID0gd2ViLndzcztcbiAgICAgICAgcGx1Z2lucyA9IHBhcmVudC5wbHVnaW5faW5zdGFuY2VzO1xuICAgICAgICBwbHVnaW5fbmFtZXMgPSBbXTtcbiAgICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBwbHVnaW5zLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgICAgKGZuJC5jYWxsKHRoaXMsIGkkLCBwbHVnaW5zW2kkXSkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgICBuYW1lOiBwYXJlbnQubmFtZSxcbiAgICAgICAgICB0eXBlOiBwYXJlbnQudHlwZSxcbiAgICAgICAgICBwbHVnaW5zOiBwbHVnaW5fbmFtZXMsXG4gICAgICAgICAgYXBpX2VuZHBvaW50czoga2V5cyhhcGlfcm91dGVzKSxcbiAgICAgICAgICB3ZWJzb2NrZXRfbmFtZXNwYWNlczoga2V5cyh3c3MpLFxuICAgICAgICAgIG9wdHM6IHdlYi5fb3B0c1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY29tcG9zZURhdGEocmVxLCByZXMsIGNvbmZpZywgMjAwKTtcbiAgICAgICAgZnVuY3Rpb24gZm4kKGksIHApe1xuICAgICAgICAgIHBsdWdpbl9uYW1lcy5wdXNoKHAubmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgc3RkLmdldCgnL2hlbGxvJywgZnVuY3Rpb24ocmVxLCByZXMpe1xuICAgICAgICByZXR1cm4gcmVzLnNlbmQoXCJ3b3JsZFwiKTtcbiAgICAgIH0pO1xuICAgICAgc3RkLmdldCgnL3RpbWUnLCBmdW5jdGlvbihyZXEsIHJlcyl7XG4gICAgICAgIHJldHVybiByZXMuc2VuZChKU09OLnN0cmluZ2lmeShuZXcgRGF0ZSgpKSArIFwiXCIpO1xuICAgICAgfSk7XG4gICAgICBzdGQuZ2V0KCcvZXhpdCcsIGZ1bmN0aW9uKHJlcSwgcmVzKXtcbiAgICAgICAgdmFyIGV4aXQ7XG4gICAgICAgIHJlcy5zZW5kKFwid2lsbCBzaHV0ZG93biBncmFjZWZ1bGx5IC4uLlxcblwiKTtcbiAgICAgICAgZXhpdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgcmV0dXJuIHByb2Nlc3MuZXhpdCgwKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZXhpdCwgMTAwMCk7XG4gICAgICB9KTtcbiAgICAgIHN0ZC5nZXQoJy9yZXN0YXJ0JywgZnVuY3Rpb24ocmVxLCByZXMpe1xuICAgICAgICB2YXIgZXhpdDtcbiAgICAgICAgcmVzLnNlbmQoXCJ3aWxsIHJlc3RhcnQgaW1tZWRpYXRlbHkgLi4uXFxuXCIpO1xuICAgICAgICBleGl0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gcHJvY2Vzcy5leGl0KDIzMCk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGV4aXQsIDEwMDApO1xuICAgICAgfSk7XG4gICAgICB3ZWIudXNlQXBpKCdzdGQnLCBzdGQpO1xuICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICB9XG4gIH07XG59KS5jYWxsKHRoaXMpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IExpdmVTY3JpcHQgMS40LjBcbihmdW5jdGlvbigpe1xuICB2YXIgbG9nZ2VyQ3VycnlpbmcsIGNyZWF0ZUFwcGxpY2F0aW9uLCBmaW5kTmFtZSwgZXhwb3J0cztcbiAgbG9nZ2VyQ3VycnlpbmcgPSBjdXJyeSQoZnVuY3Rpb24obmFtZSwgbGV2ZWwsIG1lc3NhZ2Upe1xuICAgIHJldHVybiBjb25zb2xlLmVycm9yKFwieWFwcHNbXCIgKyBuYW1lICsgXCJdOlwiICsgbGV2ZWwgKyBcIjogXCIgKyBtZXNzYWdlKTtcbiAgfSk7XG4gIGNyZWF0ZUFwcGxpY2F0aW9uID0gZnVuY3Rpb24odHlwZSwgb3B0cyl7XG4gICAgdmFyIGhlbHBlcnMsIGFwcF9jbGFzcywgYXBwLCBlcnJvcjtcbiAgICBpZiAob3B0cy52ZXJib3NlICE9IG51bGwgJiYgb3B0cy52ZXJib3NlKSB7XG4gICAgICBnbG9iYWwuREJHID0gbG9nZ2VyQ3VycnlpbmcodHlwZSwgJ2RlYnVnJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsb2JhbC5EQkcgPSBmdW5jdGlvbihtZXNzYWdlKXt9O1xuICAgIH1cbiAgICBnbG9iYWwuSU5GTyA9IGxvZ2dlckN1cnJ5aW5nKHR5cGUsICdpbmZvJyk7XG4gICAgdHJ5IHtcbiAgICAgIGhlbHBlcnMgPSB7XG4gICAgICAgIHV0aWw6IHJlcXVpcmUoJy4vbGliL3V0aWwnKSxcbiAgICAgICAgcmVzb3VyY2U6IHJlcXVpcmUoJy4vbGliL3Jlc291cmNlJyksXG4gICAgICAgIHRpbWVyOiByZXF1aXJlKCcuL2xpYi90aW1lcicpLFxuICAgICAgICBhc3luY0V4ZWN1dG9yOiByZXF1aXJlKCcuL2xpYi9hc3luYy1leGVjdXRvcicpXG4gICAgICB9O1xuICAgICAgYXBwX2NsYXNzID0gdHlwZSA9PT0gJ3dlYidcbiAgICAgICAgPyByZXF1aXJlKCcuL2xpYi9hcHBzL1dlYkFwcCcpXG4gICAgICAgIDogcmVxdWlyZSgnLi9saWIvYXBwcy9CYXNlQXBwJyk7XG4gICAgICBhcHAgPSBuZXcgYXBwX2NsYXNzKG9wdHMsIGhlbHBlcnMpO1xuICAgICAgcmV0dXJuIGFwcDtcbiAgICB9IGNhdGNoIChlJCkge1xuICAgICAgZXJyb3IgPSBlJDtcbiAgICAgIElORk8oXCJmYWlsZWQgdG8gY3JlYXRlQXBwbGljYXRpb24gJ1wiICsgdHlwZSArIFwiJywgZXJyOiBcIiArIGVycm9yKTtcbiAgICAgIHJldHVybiBwcm9jZXNzLmV4aXQoMSk7XG4gICAgfVxuICB9O1xuICBmaW5kTmFtZSA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGV4LCByZWdleHAsIG1hdGNoZXMsIGxpbmUsIHRva2VucztcbiAgICBleCA9IG5ldyBFcnJvcigpO1xuICAgIHJlZ2V4cCA9IC9cXCguKlxcL2FwcC4oanxsKXM6LipcXCkvO1xuICAgIG1hdGNoZXMgPSByZWdleHAuZXhlYyhleC5zdGFjayk7XG4gICAgaWYgKG1hdGNoZXMgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuICd1bmtub3duJztcbiAgICB9XG4gICAgbGluZSA9IG1hdGNoZXNbMF07XG4gICAgbGluZSA9IGxpbmUuc3Vic3RyaW5nKDEsIGxpbmUubGVuZ3RoIC0gMik7XG4gICAgbGluZS5yZXBsYWNlKC86LiovLCBcIlwiKTtcbiAgICB0b2tlbnMgPSBsaW5lLnNwbGl0KCcvJyk7XG4gICAgaWYgKCEodG9rZW5zLmxlbmd0aCA+PSAyKSkge1xuICAgICAgcmV0dXJuICd1bmtub3duJztcbiAgICB9XG4gICAgcmV0dXJuIHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMl07XG4gIH07XG4gIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IHtcbiAgICBjcmVhdGVBcHA6IGZ1bmN0aW9uKHR5cGUsIG9wdHMpe1xuICAgICAgdmFyIGFwcF90eXBlLCBhcHBfb3B0cztcbiAgICAgIGFwcF90eXBlID0gbnVsbDtcbiAgICAgIGFwcF9vcHRzID0gbnVsbDtcbiAgICAgIGlmICh0eXBlICE9IG51bGwpIHtcbiAgICAgICAgaWYgKCdzdHJpbmcnID09PSB0eXBlb2YgdHlwZSkge1xuICAgICAgICAgIGFwcF90eXBlID0gdHlwZTtcbiAgICAgICAgICBhcHBfb3B0cyA9IG9wdHM7XG4gICAgICAgIH0gZWxzZSBpZiAoJ29iamVjdCcgPT09IHR5cGVvZiB0eXBlKSB7XG4gICAgICAgICAgYXBwX3R5cGUgPSAnYmFzZSc7XG4gICAgICAgICAgYXBwX29wdHMgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcHBfdHlwZSA9ICdiYXNlJztcbiAgICAgICAgYXBwX29wdHMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmIChhcHBfb3B0cy5uYW1lID09IG51bGwpIHtcbiAgICAgICAgYXBwX29wdHMubmFtZSA9IGZpbmROYW1lKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3JlYXRlQXBwbGljYXRpb24oYXBwX3R5cGUsIGFwcF9vcHRzKTtcbiAgICB9XG4gIH07XG4gIGZ1bmN0aW9uIGN1cnJ5JChmLCBib3VuZCl7XG4gICAgdmFyIGNvbnRleHQsXG4gICAgX2N1cnJ5ID0gZnVuY3Rpb24oYXJncykge1xuICAgICAgcmV0dXJuIGYubGVuZ3RoID4gMSA/IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBwYXJhbXMgPSBhcmdzID8gYXJncy5jb25jYXQoKSA6IFtdO1xuICAgICAgICBjb250ZXh0ID0gYm91bmQgPyBjb250ZXh0IHx8IHRoaXMgOiB0aGlzO1xuICAgICAgICByZXR1cm4gcGFyYW1zLnB1c2guYXBwbHkocGFyYW1zLCBhcmd1bWVudHMpIDxcbiAgICAgICAgICAgIGYubGVuZ3RoICYmIGFyZ3VtZW50cy5sZW5ndGggP1xuICAgICAgICAgIF9jdXJyeS5jYWxsKGNvbnRleHQsIHBhcmFtcykgOiBmLmFwcGx5KGNvbnRleHQsIHBhcmFtcyk7XG4gICAgICB9IDogZjtcbiAgICB9O1xuICAgIHJldHVybiBfY3VycnkoKTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG4oZnVuY3Rpb24oKXtcbiAgdmFyIGJyb2Fkd2F5LCBvcHRpbWlzdCwgZXh0ZW5kaWZ5LCBidW55YW4sIGJ1bnlhbkRlYnVnU3RyZWFtLCBidW55YW5Sb3RhdGluZ0ZpbGUsIHBhdGgsIGNvbG9ycywgYXBwbHlDbWRDb25maWdzLCBJbml0RnVuY3Rpb25zLCBCYXNlQXBwLCBleHBvcnRzO1xuICBpZiAocHJvY2Vzcy5lbnZbJ1RJTUVfUkVRVUlSRSddID09PSBcInRydWVcIikge1xuICAgIHJlcXVpcmUoJ3RpbWUtcmVxdWlyZScpO1xuICB9XG4gIGJyb2Fkd2F5ID0gcmVxdWlyZSgnYnJvYWR3YXknKTtcbiAgb3B0aW1pc3QgPSByZXF1aXJlKCdvcHRpbWlzdCcpO1xuICBleHRlbmRpZnkgPSByZXF1aXJlKCdleHRlbmRpZnknKTtcbiAgYnVueWFuID0gcmVxdWlyZSgnYnVueWFuJyk7XG4gIGJ1bnlhbkRlYnVnU3RyZWFtID0gcmVxdWlyZSgnYnVueWFuLWRlYnVnLXN0cmVhbScpO1xuICBidW55YW5Sb3RhdGluZ0ZpbGUgPSByZXF1aXJlKCdidW55YW4tcm90YXRpbmctZmlsZScpO1xuICBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuICBjb2xvcnMgPSByZXF1aXJlKCdjb2xvcnMnKTtcbiAgYXBwbHlDbWRDb25maWdzID0gZnVuY3Rpb24oc2V0dGluZ3MsIHR5cGUpe1xuICAgIHZhciBpJCwgbGVuJCwgcywgdG9rZW5zLCBwcm9wLCB2YWx1ZSwgbmFtZXMsIGxhc3ROYW1lLCBjb25maWcsIGokLCBsZW4xJCwgbiwgcmVzdWx0cyQgPSBbXTtcbiAgICBpZiAoIXNldHRpbmdzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNldHRpbmdzID0gc2V0dGluZ3MgaW5zdGFuY2VvZiBBcnJheVxuICAgICAgPyBzZXR0aW5nc1xuICAgICAgOiBbc2V0dGluZ3NdO1xuICAgIGZvciAoaSQgPSAwLCBsZW4kID0gc2V0dGluZ3MubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgIHMgPSBzZXR0aW5nc1tpJF07XG4gICAgICB0b2tlbnMgPSBzLnNwbGl0KFwiPVwiKTtcbiAgICAgIHByb3AgPSB0b2tlbnNbMF07XG4gICAgICB2YWx1ZSA9IHRva2Vuc1sxXTtcbiAgICAgIGlmICgnXCInID09PSB2YWx1ZS5jaGFyQXQoMCkgJiYgJ1wiJyA9PT0gdmFsdWUuY2hhckF0KHZhbHVlLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyKDEsIHZhbHVlLmxlbmd0aCAtIDIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKFwiJ1wiID09PSB2YWx1ZS5jaGFyQXQoMCkgJiYgXCInXCIgPT09IHZhbHVlLmNoYXJBdCh2YWx1ZS5sZW5ndGggLSAxKSkge1xuICAgICAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyKDEsIHZhbHVlLmxlbmd0aCAtIDIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBuYW1lcyA9IHByb3Auc3BsaXQoXCIuXCIpO1xuICAgICAgbGFzdE5hbWUgPSBuYW1lcy5wb3AoKTtcbiAgICAgIGNvbmZpZyA9IGdsb2JhbC5jb25maWc7XG4gICAgICBmb3IgKGokID0gMCwgbGVuMSQgPSBuYW1lcy5sZW5ndGg7IGokIDwgbGVuMSQ7ICsraiQpIHtcbiAgICAgICAgbiA9IG5hbWVzW2okXTtcbiAgICAgICAgY29uZmlnID0gY29uZmlnW25dO1xuICAgICAgfVxuICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgIGNvbmZpZ1tsYXN0TmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaW50ZWdlclwiOlxuICAgICAgICBjb25maWdbbGFzdE5hbWVdID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICAgIGNvbmZpZ1tsYXN0TmFtZV0gPSBcInRydWVcIiA9PT0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwic3RyX2FycmF5XCI6XG4gICAgICAgIGNvbmZpZ1tsYXN0TmFtZV0gPSB2YWx1ZS5zcGxpdCgnLCcpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbmZpZ1tsYXN0TmFtZV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdHMkLnB1c2goSU5GTyhcImFwcGx5aW5nIFwiICsgcHJvcCArIFwiID0gXCIgKyBjb25maWdbbGFzdE5hbWVdKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzJDtcbiAgfTtcbiAgSW5pdEZ1bmN0aW9ucyA9IFtcbiAgICB7XG4gICAgICBuYW1lOiAnc3RyaW5nLWhlbHBlcnMnLFxuICAgICAgZnVuYzogZnVuY3Rpb24oKXtcbiAgICAgICAgaWYgKHR5cGVvZiBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggPSBmdW5jdGlvbihzdHIpe1xuICAgICAgICAgICAgcmV0dXJuIHN0ciA9PT0gdGhpcy5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIFN0cmluZy5wcm90b3R5cGUuZW5kc1dpdGggIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXR1cm4gU3RyaW5nLnByb3RvdHlwZS5lbmRzV2l0aCA9IGZ1bmN0aW9uKHN0cil7XG4gICAgICAgICAgICByZXR1cm4gc3RyID09PSB0aGlzLnN1YnN0cmluZyh0aGlzLmxlbmd0aCAtIHN0ci5sZW5ndGgsIHRoaXMubGVuZ3RoKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwge1xuICAgICAgbmFtZTogJ2xvYWQtY29uZmlnJyxcbiAgICAgIGZ1bmM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciByZXNvdXJjZSwgb3B0O1xuICAgICAgICByZXNvdXJjZSA9IG1vZHVsZS5yZXNvdXJjZTtcbiAgICAgICAgb3B0ID0gb3B0aW1pc3QudXNhZ2UoJ1VzYWdlOiAkMCcpLmFsaWFzKCdjJywgJ2NvbmZpZycpLmRlc2NyaWJlKCdjJywgJ3RoZSBjb25maWd1cmF0aW9uIHNldCwgbWlnaHQgYmUgZGVmYXVsdCwgYmJiMCwgLi4uJylbJ2RlZmF1bHQnXSgnYycsICdkZWZhdWx0JykuYWxpYXMoJ2InLCAnY29uZmlnX2Jvb2wnKS5kZXNjcmliZSgnYicsICdvdmVyd3JpdGUgYSBjb25maWd1cmF0aW9uIHdpdGggYm9vbGVhbiB2YWx1ZSwgZS5nLiAtYiBcInN5c3RlbS5pbmZsdXhTZXJ2ZXIuc2VjdXJlPWZhbHNlXCInKS5hbGlhcygncycsICdjb25maWdfc3RyaW5nJykuZGVzY3JpYmUoJ3MnLCAnb3ZlcndyaXRlIGEgY29uZmlndXJhdGlvbiB3aXRoIGJvb2xlYW4gdmFsdWUsIGUuZy4gLWIgXCJzeXN0ZW0uaW5mbHV4U2VydmVyLnVzZXI9c21pdGhcIicpLmFsaWFzKCdpJywgJ2NvbmZpZ19pbnQnKS5kZXNjcmliZSgnaScsICdvdmVyd3JpdGUgYSBjb25maWd1cmF0aW9uIHdpdGggaW50IHZhbHVlLCBlLmcuIC1iIFwiYmVoYXZpb3Iubm90aWZ5LmluZmx1eFBlcmlvZD1zbWl0aFwiJykuYWxpYXMoJ2EnLCAnY29uZmlnX3N0cl9hcnJheScpLmRlc2NyaWJlKCdhJywgJ292ZXJ3cml0ZSBhIGNvbmZpZ3VyYXRpb24gd2l0aCBhcnJheSBvZiBzdHJpbmdzIHdpdGggZGVsaW1pdGVyIGNoYXJhY3RlciBgQ09NTUFgLCBlLmcuIC1iIFwic3lzdGVtLmluZmx1eFNlcnZlci5jbHVzdGVycz1hYS50ZXN0Lm5ldCxiYi50ZXN0Lm5ldCxjYy50ZXN0Lm5ldFwiJykuYWxpYXMoJ3YnLCAndmVyYm9zZScpLmRlc2NyaWJlKCd2JywgJ3ZlcmJvc2UgbWVzc2FnZSBvdXRwdXQgKGxldmVsIGlzIGNoYW5nZWQgdG8gYGRlYnVnYCknKVsnZGVmYXVsdCddKCd2JywgZmFsc2UpLmFsaWFzKCdxJywgJ3F1aWV0JykuZGVzY3JpYmUoJ3EnLCAnZGlzYWJsZSBsb2dnaW5nIG91dHB1dHMgdG8gbG9jYWwgZmlsZSwgYnV0IHN0aWxsIG91dHB1dHMgdG8gc3RkZXJyJylbJ2RlZmF1bHQnXSgncScsIGZhbHNlKS5ib29sZWFuKFsnaCcsICd2J10pO1xuICAgICAgICBnbG9iYWwuYXJndiA9IG9wdC5hcmd2O1xuICAgICAgICBpZiAoZ2xvYmFsLmFyZ3YuaCkge1xuICAgICAgICAgIG9wdC5zaG93SGVscCgpO1xuICAgICAgICAgIHByb2Nlc3MuZXhpdCgwKTtcbiAgICAgICAgfVxuICAgICAgICBnbG9iYWwuY29uZmlnID0gcmVzb3VyY2UubG9hZENvbmZpZyhnbG9iYWwuYXJndi5jb25maWcpO1xuICAgICAgICBpZiAoZ2xvYmFsLmNvbmZpZyA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgICAgICBhcHBseUNtZENvbmZpZ3MoZ2xvYmFsLmFyZ3YucywgXCJzdHJpbmdcIik7XG4gICAgICAgIGFwcGx5Q21kQ29uZmlncyhnbG9iYWwuYXJndi5pLCBcImludGVnZXJcIik7XG4gICAgICAgIGFwcGx5Q21kQ29uZmlncyhnbG9iYWwuYXJndi5iLCBcImJvb2xlYW5cIik7XG4gICAgICAgIHJldHVybiBhcHBseUNtZENvbmZpZ3MoZ2xvYmFsLmFyZ3YuYSwgXCJzdHJfYXJyYXlcIik7XG4gICAgICB9XG4gICAgfVxuICBdO1xuICBCYXNlQXBwID0gKGZ1bmN0aW9uKCl7XG4gICAgQmFzZUFwcC5kaXNwbGF5TmFtZSA9ICdCYXNlQXBwJztcbiAgICB2YXIgcHJvdG90eXBlID0gQmFzZUFwcC5wcm90b3R5cGUsIGNvbnN0cnVjdG9yID0gQmFzZUFwcDtcbiAgICBmdW5jdGlvbiBCYXNlQXBwKG9wdHMsIGhlbHBlcnMpe1xuICAgICAgdGhpcy5vcHRzID0gb3B0cztcbiAgICAgIHRoaXMuaGVscGVycyA9IGhlbHBlcnM7XG4gICAgICBEQkcoXCJCYXNlQXBwIGNvbnN0cnVjdG9yXCIpO1xuICAgICAgdGhpcy50eXBlID0gJ2Jhc2UnO1xuICAgICAgdGhpcy5uYW1lID0gdGhpcy5vcHRzLm5hbWU7XG4gICAgICB0aGlzLnJlc291cmNlID0gbW9kdWxlLnJlc291cmNlID0gaGVscGVycy5yZXNvdXJjZTtcbiAgICAgIHRoaXMuYXN5bmNFeGVjdXRvciA9IGhlbHBlcnMuYXN5bmNFeGVjdXRvcjtcbiAgICAgIHRoaXMucGx1Z2luX2luc3RhbmNlcyA9IFtdO1xuICAgIH1cbiAgICBwcm90b3R5cGUuYWRkUGx1Z2luID0gZnVuY3Rpb24ocCl7XG4gICAgICByZXR1cm4gdGhpcy5vcHRzLnBsdWdpbnMucHVzaChwKTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5pbml0TG9nZ2VyID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBwbHVnaW5zLCByZXNvdXJjZSwgYXBwX25hbWUsIHByZWZpeGVycywgc3RyaW5naWZpZXJzLCBsZXZlbCwgbG9nZ2luZ19kaXIsIGxvZ2dpbmdfb3B0cywgbG9nZ2VyLCBhcHBfbG9nZ2VyLCBnbG9iYWxfbG9nZ2VyO1xuICAgICAgcGx1Z2lucyA9IHRoaXMub3B0cy5wbHVnaW5zO1xuICAgICAgcmVzb3VyY2UgPSB0aGlzLnJlc291cmNlO1xuICAgICAgYXBwX25hbWUgPSB0aGlzLm5hbWU7XG4gICAgICBwcmVmaXhlcnMgPSB7XG4gICAgICAgIG1vZHVsZTogZnVuY3Rpb24obSl7XG4gICAgICAgICAgaWYgKG0ucGx1Z2luICE9IG51bGwgJiYgbS5wbHVnaW4pIHtcbiAgICAgICAgICAgIHJldHVybiBcInBsdWdpbjo6XCIgKyBtLm5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtLmRlYnVnICE9IG51bGwgJiYgbS5kZWJ1Zykge1xuICAgICAgICAgICAgcmV0dXJuIFwiZGVidWc6OlwiICsgbS5uYW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbS5uYW1lO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgc3RyaW5naWZpZXJzID0ge1xuICAgICAgICBjb25maWc6IGZ1bmN0aW9uKGMpe1xuICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjLCBudWxsLCA0KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIC8qXG4gICAgICBmb3IgbGV0IHAsIGkgaW4gcGx1Z2luc1xuICAgICAgICBjb25maWcgPSBnbG9iYWwuY29uZmlnW3BdXG4gICAgICAgIGlmIGNvbmZpZz8gYW5kIGNvbmZpZ1tcXGxvZ2dlcl0/XG4gICAgICAgICAgbG9nX2NvbmZpZyA9IGNvbmZpZy5sb2dnZXJcbiAgICAgICAgICBpZiBsb2dfY29uZmlnW1xccHJlZml4ZXJzXT9cbiAgICAgICAgICAgIGZvciBsZXQgbmFtZSwgZnVuYyBvZiBsb2dfY29uZmlnLnByZWZpeGVyc1xuICAgICAgICAgICAgICBpZiBwcmVmaXhlcnNbbmFtZV0/XG4gICAgICAgICAgICAgICAgSU5GTyBcInBsdWdpblsje3B9XSBsb2FkcyBhIGR1cGxpY2F0ZSBsb2dnaW5nIHByZWZpeGVyIDwje25hbWV9PlwiXG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBwcmVmaXhlcnNbbmFtZV0gPSBmdW5jXG4gICAgICBcbiAgICAgICAgICBpZiBsb2dfY29uZmlnW1xcc3RyaW5naWZpZXJzXT9cbiAgICAgICAgICAgIGZvciBsZXQgbmFtZSwgZnVuYyBvZiBsb2dfY29uZmlnLnN0cmluZ2lmaWVyc1xuICAgICAgICAgICAgICBpZiBzdHJpbmdpZmllcnNbbmFtZV0/XG4gICAgICAgICAgICAgICAgSU5GTyBcInBsdWdpblsje3B9XSBsb2FkcyBhIGR1cGxpY2F0ZSBsb2dnaW5nIHByZWZpeGVyIDwje25hbWV9PlwiXG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcnNbbmFtZV0gPSBmdW5jXG4gICAgICAqL1xuICAgICAgaWYgKGdsb2JhbC5hcmd2LnYgIT0gbnVsbCAmJiBnbG9iYWwuYXJndi52KSB7XG4gICAgICAgIERCRyhcInZlcmJvc2UgKC12KSBpcyBlbmFibGVkXCIpO1xuICAgICAgfVxuICAgICAgbGV2ZWwgPSBnbG9iYWwuYXJndi52ID8gJ2RlYnVnJyA6ICdpbmZvJztcbiAgICAgIGxvZ2dpbmdfZGlyID0gcmVzb3VyY2UucmVzb2x2ZVdvcmtQYXRoKCdsb2dzJywgJycpO1xuICAgICAgbG9nZ2luZ19vcHRzID0ge1xuICAgICAgICBuYW1lOiBhcHBfbmFtZSxcbiAgICAgICAgc2VyaWFsaXplcnM6IGJ1bnlhbkRlYnVnU3RyZWFtLnNlcmlhbGl6ZXJzLFxuICAgICAgICBzdHJlYW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbGV2ZWw6IGxldmVsLFxuICAgICAgICAgICAgdHlwZTogJ3JhdycsXG4gICAgICAgICAgICBzdHJlYW06IGJ1bnlhbkRlYnVnU3RyZWFtKHtcbiAgICAgICAgICAgICAgb3V0OiBwcm9jZXNzLnN0ZGVycixcbiAgICAgICAgICAgICAgc2hvd1Byb2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICBjb2xvcnM6IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZzogJ2dyYXknLFxuICAgICAgICAgICAgICAgIGluZm86ICd3aGl0ZSdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgcHJlZml4ZXJzOiBwcmVmaXhlcnMsXG4gICAgICAgICAgICAgIHN0cmluZ2lmaWVyczogc3RyaW5naWZpZXJzXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGxldmVsOiAnZGVidWcnLFxuICAgICAgICAgICAgdHlwZTogJ3JvdGF0aW5nLWZpbGUnLFxuICAgICAgICAgICAgcGF0aDogbG9nZ2luZ19kaXIgKyBcIlwiICsgcGF0aC5zZXAgKyBcIi9hcHAubG9nXCIsXG4gICAgICAgICAgICBwZXJpb2Q6ICcxZCcsXG4gICAgICAgICAgICBjb3VudDogN1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICAgIGlmIChnbG9iYWwuYXJndi5xKSB7XG4gICAgICAgIGxvZ2dpbmdfb3B0cy5zdHJlYW1zLnBvcCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5leHRlbmRpZnkgPSBleHRlbmRpZnkoKTtcbiAgICAgIGlmIChnbG9iYWwuY29uZmlnLmxvZ2dlciAhPSBudWxsKSB7XG4gICAgICAgIGxvZ2dpbmdfb3B0cyA9IHRoaXMuZXh0ZW5kaWZ5KGxvZ2dpbmdfb3B0cywgZ2xvYmFsLmNvbmZpZy5sb2dnZXIpO1xuICAgICAgfVxuICAgICAgZ2xvYmFsLnlhcHBfbG9nZ2VyID0gbG9nZ2VyID0gYnVueWFuLmNyZWF0ZUxvZ2dlcihsb2dnaW5nX29wdHMpO1xuICAgICAgYXBwX2xvZ2dlciA9IHRoaXMubG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHtcbiAgICAgICAgbW9kdWxlOiB7XG4gICAgICAgICAgbmFtZTogJ0Jhc2VBcHAnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgYXBwX2xvZ2dlci5kZWJ1ZyhcImxvZ2dlciBpbml0aWF0ZWRcIik7XG4gICAgICBnbG9iYWxfbG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHtcbiAgICAgICAgbW9kdWxlOiB7XG4gICAgICAgICAgbmFtZTogJ0dMT0JBTCdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBnbG9iYWwuREJHID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGdsb2JhbF9sb2dnZXIuZGVidWcuYXBwbHkoZ2xvYmFsX2xvZ2dlciwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgICBnbG9iYWwuSU5GTyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBnbG9iYWxfbG9nZ2VyLmluZm8uYXBwbHkoZ2xvYmFsX2xvZ2dlciwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgICBnbG9iYWwuV0FSTiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBnbG9iYWxfbG9nZ2VyLndhcm4uYXBwbHkoZ2xvYmFsX2xvZ2dlciwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgICBnbG9iYWwuRVJSID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGdsb2JhbF9sb2dnZXIuZXJyb3IuYXBwbHkoZ2xvYmFsX2xvZ2dlciwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgICBnbG9iYWwuRkFUQUwgPSBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gZ2xvYmFsX2xvZ2dlci5mYXRhbC5hcHBseShnbG9iYWxfbG9nZ2VyLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtb2R1bGUuREJHVCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBhcHBfbG9nZ2VyLmRlYnVnLmFwcGx5KGFwcF9sb2dnZXIsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH07XG4gICAgcHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihkb25lKXtcbiAgICAgIHZhciBzZWxmLCBhc3luY0V4ZWN1dG9yLCByZXNvdXJjZSwgb3B0cywgcGx1Z2lucywgaSQsIHJlZiQsIGxlbiQsIGFwcCwgdGFza3MsIGxvZ2dlciwgY29uZmlnLCBjb250ZXh0LCBhZTtcbiAgICAgIHNlbGYgPSB0aGlzO1xuICAgICAgYXN5bmNFeGVjdXRvciA9IHNlbGYuYXN5bmNFeGVjdXRvciwgcmVzb3VyY2UgPSBzZWxmLnJlc291cmNlLCBvcHRzID0gc2VsZi5vcHRzO1xuICAgICAgcGx1Z2lucyA9IG9wdHMucGx1Z2lucztcbiAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBJbml0RnVuY3Rpb25zKS5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICAoZm4kLmNhbGwodGhpcywgaSQsIHJlZiRbaSRdKSk7XG4gICAgICB9XG4gICAgICB0aGlzLmluaXRMb2dnZXIoKTtcbiAgICAgIGFwcCA9IHRoaXMuYXBwID0gbmV3IGJyb2Fkd2F5LkFwcDtcbiAgICAgIGFwcC5wYXJlbnQgPSBzZWxmO1xuICAgICAgdGFza3MgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnZHVtbXknLFxuICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKGFlLCBjdHgsIGRiZywgZG9uZSl7XG4gICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgIG5hbWU6ICdsb2FkLXBsdWdpbnMnLFxuICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKGFlLCBjdHgsIGRiZywgZG9uZSl7XG4gICAgICAgICAgICB2YXIgY29uZmlnLCBhcHAsIHBsdWdpbnMsIHNlbGYsIGkkLCBsZW4kO1xuICAgICAgICAgICAgY29uZmlnID0gY3R4LmNvbmZpZywgYXBwID0gY3R4LmFwcCwgcGx1Z2lucyA9IGN0eC5wbHVnaW5zLCBzZWxmID0gY3R4LnNlbGY7XG4gICAgICAgICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IHBsdWdpbnMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgICAgICAgKGZuJC5jYWxsKHRoaXMsIGkkLCBwbHVnaW5zW2kkXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGZuJChpLCBwKXtcbiAgICAgICAgICAgICAgdmFyIG5hbWUsIGxvZ2dlciwgaGVscGVycywgYywgZXJyb3I7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbmFtZSA9IHAuTkFNRTtcbiAgICAgICAgICAgICAgICBsb2dnZXIgPSBzZWxmLmxvZ2dlci5jaGlsZCh7XG4gICAgICAgICAgICAgICAgICBtb2R1bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaGVscGVycyA9IHtcbiAgICAgICAgICAgICAgICAgIGxvZ2dlcjogbG9nZ2VyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBoZWxwZXJzID0gc2VsZi5leHRlbmRpZnkoaGVscGVycywgc2VsZi5oZWxwZXJzKTtcbiAgICAgICAgICAgICAgICBjID0ge307XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ1tuYW1lXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICBjID0gc2VsZi5leHRlbmRpZnkoYywgY29uZmlnW25hbWVdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYyA9IHNlbGYuZXh0ZW5kaWZ5KGMsIHtcbiAgICAgICAgICAgICAgICAgIGhlbHBlcnM6IGhlbHBlcnNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhcHAudXNlKHAsIGMpO1xuICAgICAgICAgICAgICAgIHNlbGYucGx1Z2luX2luc3RhbmNlcy5wdXNoKHApO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlJCkge1xuICAgICAgICAgICAgICAgIGVycm9yID0gZSQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoZXJyb3IpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgbmFtZTogJ2luaXQtcGx1Z2lucycsXG4gICAgICAgICAgZnVuYzogZnVuY3Rpb24oYWUsIGN0eCwgZGJnLCBkb25lKXtcbiAgICAgICAgICAgIHZhciBhcHA7XG4gICAgICAgICAgICBhcHAgPSBjdHguYXBwO1xuICAgICAgICAgICAgcmV0dXJuIGFwcC5pbml0KGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgIHJldHVybiBkb25lKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBuYW1lOiAnc3RhcnR1cC1wbHVnaW5zJyxcbiAgICAgICAgICBmdW5jOiBmdW5jdGlvbihhZSwgY3R4LCBkYmcsIGRvbmUpe1xuICAgICAgICAgICAgZGJnKFwiZW50ZXJcIik7XG4gICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXTtcbiAgICAgIGxvZ2dlciA9IHNlbGYubG9nZ2VyO1xuICAgICAgY29uZmlnID0gZ2xvYmFsLmNvbmZpZztcbiAgICAgIGNvbnRleHQgPSB7XG4gICAgICAgIGNvbmZpZzogY29uZmlnLFxuICAgICAgICByZXNvdXJjZTogcmVzb3VyY2UsXG4gICAgICAgIGFwcDogYXBwLFxuICAgICAgICBwbHVnaW5zOiBwbHVnaW5zLFxuICAgICAgICBzZWxmOiBzZWxmXG4gICAgICB9O1xuICAgICAgYWUgPSBuZXcgYXN5bmNFeGVjdXRvcih7XG4gICAgICAgIHR5cGU6ICdhcHAnLFxuICAgICAgICBsb2dnZXI6IG1vZHVsZS5EQkdULFxuICAgICAgICBjb250ZXh0OiBjb250ZXh0XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhZS5zZXJpZXModGFza3MsIGZ1bmN0aW9uKGV4ZWN1dG9yLCBjdHgsIGVyciwgcmVzdWx0cyl7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudlsnVElNRV9SRVFVSVJFJ10gPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHByb2Nlc3MuZXhpdCgwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXJyID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICB9XG4gICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKGVyciwgXCJpbml0aWFsaXphdGlvbiBmYWlsdXJlXCIpO1xuICAgICAgICByZXR1cm4gZG9uZShlcnIpO1xuICAgICAgfSk7XG4gICAgICBmdW5jdGlvbiBmbiQoaSwgaW5pdF9mdW5jKXtcbiAgICAgICAgREJHKFwiYm9vdGluZzogXCIgKyBpbml0X2Z1bmMubmFtZSArIFwiIC4uLlwiKTtcbiAgICAgICAgaW5pdF9mdW5jLmZ1bmMoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuYW1lKXtcbiAgICAgIHJldHVybiB0aGlzLmFwcFtuYW1lXTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgb25GdW5jO1xuICAgICAgb25GdW5jID0gdGhpcy5hcHAub247XG4gICAgICByZXR1cm4gb25GdW5jLmFwcGx5KHRoaXMuYXBwLCBhcmd1bWVudHMpO1xuICAgIH07XG4gICAgcmV0dXJuIEJhc2VBcHA7XG4gIH0oKSk7XG4gIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IEJhc2VBcHA7XG59KS5jYWxsKHRoaXMpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IExpdmVTY3JpcHQgMS40LjBcbihmdW5jdGlvbigpe1xuICB2YXIgeVdlYiwgeVdlYmFwaVN0ZCwgQmFzZUFwcCwgV2ViQXBwLCBleHBvcnRzO1xuICB5V2ViID0gcmVxdWlyZSgneS13ZWInKTtcbiAgeVdlYmFwaVN0ZCA9IHJlcXVpcmUoJ3ktd2ViYXBpLXN0ZCcpO1xuICBCYXNlQXBwID0gcmVxdWlyZShcIi4vQmFzZUFwcFwiKTtcbiAgV2ViQXBwID0gKGZ1bmN0aW9uKHN1cGVyY2xhc3Mpe1xuICAgIHZhciBwcm90b3R5cGUgPSBleHRlbmQkKChpbXBvcnQkKFdlYkFwcCwgc3VwZXJjbGFzcykuZGlzcGxheU5hbWUgPSAnV2ViQXBwJywgV2ViQXBwKSwgc3VwZXJjbGFzcykucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IFdlYkFwcDtcbiAgICBmdW5jdGlvbiBXZWJBcHAob3B0cywgaGVscGVycyl7XG4gICAgICB0aGlzLm9wdHMgPSBvcHRzO1xuICAgICAgdGhpcy5oZWxwZXJzID0gaGVscGVycztcbiAgICAgIFdlYkFwcC5zdXBlcmNsYXNzLmNhbGwodGhpcywgb3B0cywgaGVscGVycyk7XG4gICAgICB0aGlzLmFkZFBsdWdpbihyZXF1aXJlKCd5LXdlYicpKTtcbiAgICAgIHRoaXMuYWRkUGx1Z2luKHJlcXVpcmUoJ3ktd2ViYXBpLXN0ZCcpKTtcbiAgICB9XG4gICAgcHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihkb25lKXtcbiAgICAgIHZhciBzZWxmO1xuICAgICAgc2VsZiA9IHRoaXM7XG4gICAgICByZXR1cm4gc3VwZXJjbGFzcy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIGZ1bmN0aW9uKGVycil7XG4gICAgICAgIHZhciB3ZWI7XG4gICAgICAgIGlmIChlcnIgIT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBkb25lKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgd2ViID0gc2VsZi5hcHAud2ViO1xuICAgICAgICByZXR1cm4gd2ViLnN0YXJ0KGRvbmUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gV2ViQXBwO1xuICB9KEJhc2VBcHApKTtcbiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gV2ViQXBwO1xuICBmdW5jdGlvbiBleHRlbmQkKHN1Yiwgc3VwKXtcbiAgICBmdW5jdGlvbiBmdW4oKXt9IGZ1bi5wcm90b3R5cGUgPSAoc3ViLnN1cGVyY2xhc3MgPSBzdXApLnByb3RvdHlwZTtcbiAgICAoc3ViLnByb3RvdHlwZSA9IG5ldyBmdW4pLmNvbnN0cnVjdG9yID0gc3ViO1xuICAgIGlmICh0eXBlb2Ygc3VwLmV4dGVuZGVkID09ICdmdW5jdGlvbicpIHN1cC5leHRlbmRlZChzdWIpO1xuICAgIHJldHVybiBzdWI7XG4gIH1cbiAgZnVuY3Rpb24gaW1wb3J0JChvYmosIHNyYyl7XG4gICAgdmFyIG93biA9IHt9Lmhhc093blByb3BlcnR5O1xuICAgIGZvciAodmFyIGtleSBpbiBzcmMpIGlmIChvd24uY2FsbChzcmMsIGtleSkpIG9ialtrZXldID0gc3JjW2tleV07XG4gICAgcmV0dXJuIG9iajtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG4oZnVuY3Rpb24oKXtcbiAgdmFyIGFzeW5jLCBjb2xvcnMsIHVpZCwgbG9nZ2VyQ3VycnlpbmcsIHJ1blRhc2tDdXJyeWluZywgc2VyaWVzRW5kQ3VycnlpbmcsIGV4cG9ydHMsIEFzeW5jRXhlY3V0b3I7XG4gIGFzeW5jID0gcmVxdWlyZSgnYXN5bmMnKTtcbiAgY29sb3JzID0gcmVxdWlyZSgnY29sb3JzJyk7XG4gIHVpZCA9IHJlcXVpcmUoJ3VpZCcpO1xuICBsb2dnZXJDdXJyeWluZyA9IGN1cnJ5JChmdW5jdGlvbihleGVjdXRvciwgdGFza19uYW1lLCBsb2dnZXIsIG1lc3NhZ2Upe1xuICAgIHZhciBudW0sIGlkLCBwcmVmaXgsIHRleHQ7XG4gICAgbnVtID0gZXhlY3V0b3IubnVtICsgXCJcIjtcbiAgICBpZCA9IGV4ZWN1dG9yLmlkICsgXCItXCIgKyBudW07XG4gICAgcHJlZml4ID0gZXhlY3V0b3IudHlwZSArIFwiW1wiICsgaWQuZ3JheSArIFwiXS5cIiArIHRhc2tfbmFtZTtcbiAgICB0ZXh0ID0gcHJlZml4ICsgXCIgXCIgKyBtZXNzYWdlO1xuICAgIGlmIChsb2dnZXIgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGxvZ2dlcih0ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnNvbGUubG9nKHRleHQpO1xuICB9KTtcbiAgcnVuVGFza0N1cnJ5aW5nID0gY3VycnkkKGZ1bmN0aW9uKGV4ZWN1dG9yLCBjb250ZXh0LCBsb2dnZXIsIHRhc2tfbmFtZSwgZnVuYywgY2Ipe1xuICAgIHZhciBEQkcsIGVycm9yO1xuICAgIERCRyA9IGxvZ2dlckN1cnJ5aW5nKGV4ZWN1dG9yLCB0YXNrX25hbWUsIGxvZ2dlcik7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBmdW5jKGV4ZWN1dG9yLCBjb250ZXh0LCBEQkcsIGZ1bmN0aW9uKGVyciwgcmVzdWx0KXtcbiAgICAgICAgcmV0dXJuIGNiKGVyciwgcmVzdWx0KTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUkKSB7XG4gICAgICBlcnJvciA9IGUkO1xuICAgICAgREJHKGVycm9yLnN0YWNrLnJlZCArIFwiXCIpO1xuICAgICAgcmV0dXJuIGNiKGVycm9yLCBudWxsKTtcbiAgICB9XG4gIH0pO1xuICBzZXJpZXNFbmRDdXJyeWluZyA9IGN1cnJ5JChmdW5jdGlvbihleGVjdXRvciwgY2IsIGVyciwgcmVzdWx0cyl7XG4gICAgcmV0dXJuIGNiKGV4ZWN1dG9yLCBleGVjdXRvci5jb250ZXh0LCBlcnIsIHJlc3VsdHMpO1xuICB9KTtcbiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gQXN5bmNFeGVjdXRvciA9IChmdW5jdGlvbigpe1xuICAgIEFzeW5jRXhlY3V0b3IuZGlzcGxheU5hbWUgPSAnQXN5bmNFeGVjdXRvcic7XG4gICAgdmFyIHByb3RvdHlwZSA9IEFzeW5jRXhlY3V0b3IucHJvdG90eXBlLCBjb25zdHJ1Y3RvciA9IEFzeW5jRXhlY3V0b3I7XG4gICAgZnVuY3Rpb24gQXN5bmNFeGVjdXRvcihvcHRpb25zKXtcbiAgICAgIHZhciB0eXBlLCBsb2dnZXIsIGNvbnRleHQsIGlkO1xuICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgIGlmIChvcHRpb25zICE9IG51bGwpIHtcbiAgICAgICAgdHlwZSA9IG9wdGlvbnMudHlwZSwgbG9nZ2VyID0gb3B0aW9ucy5sb2dnZXIsIGNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQsIGlkID0gb3B0aW9ucy5pZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQgIT0gbnVsbFxuICAgICAgICA/IGNvbnRleHRcbiAgICAgICAgOiB7fTtcbiAgICAgIHRoaXMudHlwZSA9IHR5cGUgIT0gbnVsbCA/IHR5cGUgOiBcInVua25vd25cIjtcbiAgICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyICE9IG51bGxcbiAgICAgICAgPyBsb2dnZXJcbiAgICAgICAgOiBjb25zb2xlLmxvZztcbiAgICAgIHRoaXMuaWQgPSBpZCAhPSBudWxsXG4gICAgICAgID8gaWRcbiAgICAgICAgOiB1aWQoKTtcbiAgICAgIHRoaXMubnVtID0gMDtcbiAgICB9XG4gICAgcHJvdG90eXBlLnNlcmllcyA9IGZ1bmN0aW9uKHRhc2tzLCBjYWxsYmFjayl7XG4gICAgICB2YXIgbmV3X2Z1bmNzLCBpJCwgbGVuJCwgZW5kO1xuICAgICAgbmV3X2Z1bmNzID0gW107XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IHRhc2tzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIChmbiQuY2FsbCh0aGlzLCBpJCwgdGFza3NbaSRdKSk7XG4gICAgICB9XG4gICAgICBlbmQgPSBzZXJpZXNFbmRDdXJyeWluZyh0aGlzLCBjYWxsYmFjayk7XG4gICAgICBhc3luYy5zZXJpZXMobmV3X2Z1bmNzLCBlbmQpO1xuICAgICAgcmV0dXJuIHRoaXMubnVtID0gdGhpcy5udW0gKyAxO1xuICAgICAgZnVuY3Rpb24gZm4kKGksIHQpe1xuICAgICAgICB2YXIgZnVuYztcbiAgICAgICAgZnVuYyA9IHJ1blRhc2tDdXJyeWluZyh0aGlzLCB0aGlzLmNvbnRleHQsIHRoaXMubG9nZ2VyLCB0Lm5hbWUsIHQuZnVuYyk7XG4gICAgICAgIG5ld19mdW5jcy5wdXNoKGZ1bmMpO1xuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIEFzeW5jRXhlY3V0b3I7XG4gIH0oKSk7XG4gIGZ1bmN0aW9uIGN1cnJ5JChmLCBib3VuZCl7XG4gICAgdmFyIGNvbnRleHQsXG4gICAgX2N1cnJ5ID0gZnVuY3Rpb24oYXJncykge1xuICAgICAgcmV0dXJuIGYubGVuZ3RoID4gMSA/IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBwYXJhbXMgPSBhcmdzID8gYXJncy5jb25jYXQoKSA6IFtdO1xuICAgICAgICBjb250ZXh0ID0gYm91bmQgPyBjb250ZXh0IHx8IHRoaXMgOiB0aGlzO1xuICAgICAgICByZXR1cm4gcGFyYW1zLnB1c2guYXBwbHkocGFyYW1zLCBhcmd1bWVudHMpIDxcbiAgICAgICAgICAgIGYubGVuZ3RoICYmIGFyZ3VtZW50cy5sZW5ndGggP1xuICAgICAgICAgIF9jdXJyeS5jYWxsKGNvbnRleHQsIHBhcmFtcykgOiBmLmFwcGx5KGNvbnRleHQsIHBhcmFtcyk7XG4gICAgICB9IDogZjtcbiAgICB9O1xuICAgIHJldHVybiBfY3VycnkoKTtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG4oZnVuY3Rpb24oKXtcbiAgdmFyIGZzLCBwYXRoLCBhc3luYywgc2V0dGluZ3MsIERFQlVHLCBDSEVDSywgTE9BRF9DT05GSUcsIHJlc291cmNlLCBleHBvcnRzO1xuICBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG4gIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG4gIGFzeW5jID0gcmVxdWlyZSgnYXN5bmMnKTtcbiAgc2V0dGluZ3MgPSB7XG4gICAgcHJvZ3JhbV9uYW1lOiBudWxsLFxuICAgIGFwcF9kaXI6IG51bGwsXG4gICAgd29ya19kaXI6IG51bGwsXG4gICAgY29uZmlnX2RpcjogbnVsbFxuICB9O1xuICBERUJVRyA9IGZ1bmN0aW9uKG1lc3NhZ2Upe1xuICAgIGlmIChwcm9jZXNzLmVudi5WRVJCT1NFKSB7XG4gICAgICByZXR1cm4gY29uc29sZS5lcnJvcihtZXNzYWdlKTtcbiAgICB9XG4gIH07XG4gIENIRUNLID0gZnVuY3Rpb24ocCl7XG4gICAgdmFyIGNvbmZpZ19kaXIsIGxvZ19kaXIsIGRpcnMsIGVycm9yO1xuICAgIGNvbmZpZ19kaXIgPSBwYXRoLnJlc29sdmUocCArIFwiXCIgKyBwYXRoLnNlcCArIFwiY29uZmlnXCIpO1xuICAgIGxvZ19kaXIgPSBwYXRoLnJlc29sdmUocCArIFwiXCIgKyBwYXRoLnNlcCArIFwibG9nc1wiKTtcbiAgICBERUJVRyhcImNoZWNraW5nIFwiICsgcGF0aC5yZXNvbHZlKHApKTtcbiAgICB0cnkge1xuICAgICAgZGlycyA9IGZzLnJlYWRkaXJTeW5jKGNvbmZpZ19kaXIpO1xuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGxvZ19kaXIpKSB7XG4gICAgICAgIGZzLm1rZGlyU3luYyhsb2dfZGlyKTtcbiAgICAgIH1cbiAgICAgIHNldHRpbmdzLndvcmtfZGlyID0gcDtcbiAgICAgIHNldHRpbmdzLmNvbmZpZ19kaXIgPSBjb25maWdfZGlyO1xuICAgICAgY29uc29sZS5sb2coXCJ1c2UgXCIgKyBwYXRoLnJlc29sdmUocCkgKyBcIiBhcyB3b3JrX2RpclwiKTtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcInVzZSBcIiArIHNldHRpbmdzLmFwcF9kaXIgKyBcIiBhcyBhcHBfZGlyXCIpO1xuICAgIH0gY2F0Y2ggKGUkKSB7XG4gICAgICBlcnJvciA9IGUkO1xuICAgICAgcmV0dXJuIERFQlVHKFwiY2hlY2tpbmcgXCIgKyBwYXRoLnJlc29sdmUocCkgKyBcIiBidXQgZmFpbGVkXCIpO1xuICAgIH1cbiAgfTtcbiAgaWYgKHByb2Nlc3MuYXJndlsxXSAhPSBudWxsKSB7XG4gICAgc2V0dGluZ3MucHJvZ3JhbV9uYW1lID0gcGF0aC5iYXNlbmFtZShwcm9jZXNzLmFyZ3ZbMV0pO1xuICB9IGVsc2Uge1xuICAgIHNldHRpbmdzLnByb2dyYW1fbmFtZSA9IFwidW5rbm93blwiO1xuICB9XG4gIGlmIChwcm9jZXNzLmFyZ3ZbMV0gIT0gbnVsbCkge1xuICAgIHNldHRpbmdzLmFwcF9kaXIgPSBwYXRoLmRpcm5hbWUocHJvY2Vzcy5hcmd2WzFdKTtcbiAgfSBlbHNlIHtcbiAgICBzZXR0aW5ncy5hcHBfZGlyID0gcHJvY2Vzcy5jd2QoKTtcbiAgfVxuICBpZiAocHJvY2Vzcy5lbnZbJ1dPUktfRElSJ10gIT0gbnVsbCkge1xuICAgIENIRUNLKHByb2Nlc3MuZW52WydXT1JLX0RJUiddKTtcbiAgfVxuICBpZiAoIXNldHRpbmdzLndvcmtfZGlyKSB7XG4gICAgQ0hFQ0socGF0aC5yZXNvbHZlKFwiLlwiKSk7XG4gIH1cbiAgaWYgKCFzZXR0aW5ncy53b3JrX2RpciAmJiBwcm9jZXNzLmFyZ3ZbMV0gIT0gbnVsbCkge1xuICAgIENIRUNLKHBhdGguZGlybmFtZShwcm9jZXNzLmFyZ3ZbMV0pKTtcbiAgfVxuICBpZiAoIXNldHRpbmdzLndvcmtfZGlyKSB7XG4gICAgY29uc29sZS5lcnJvcihcImZhaWxlZCB0byBmaW5kIGFueSB3b3JrIGRpcmVjdG9yeS5cIik7XG4gICAgaWYgKHByb2Nlc3MuZW52LlZFUkJPU0UgPT0gbnVsbCkge1xuICAgICAgY29uc29sZS5lcnJvcihcInBsZWFzZSByZS1ydW4gdGhlIHByb2dyYW0gd2l0aCBlbnZpcm9ubWVudCB2YXJpYWJsZSBWRVJCT1NFPXRydWUgdG8gZ2V0IGZ1cnRoZXIgdmVyYm9zZSBtZXNzYWdlcy4uLlwiKTtcbiAgICB9XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG4gIExPQURfQ09ORklHID0gZnVuY3Rpb24ocCwgY2FsbGJhY2spe1xuICAgIHZhciBmb3VuZCwgY29uZmlnLCBlcnJvcjtcbiAgICBmb3VuZCA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBjb25maWcgPSBwLmpzb25cbiAgICAgICAgPyBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwLnBhdGgpKVxuICAgICAgICA6IHJlcXVpcmUocC5wYXRoKTtcbiAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGNvbmZpZyk7XG4gICAgfSBjYXRjaCAoZSQpIHtcbiAgICAgIGVycm9yID0gZSQ7XG4gICAgICBEQkcoXCJmYWlsZWQgdG8gbG9hZCBcIiArIHAucGF0aCArIFwiIGR1ZSB0byBlcnJvcjogXCIgKyBlcnJvcik7XG4gICAgfVxuICAgIHJldHVybiBmb3VuZDtcbiAgfTtcbiAgcmVzb3VyY2UgPSB7XG4gICAgLyoqXG4gICAgICogRHVtcCBhbGwgZW52aXJvbWVudCB2YXJpYWJsZXNcbiAgICAgKi9cbiAgICBkdW1wRW52czogZnVuY3Rpb24oKXtcbiAgICAgIHZhciBpJCwgcmVmJCwgbGVuJDtcbiAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gKHJlZiQgPSBwcm9jZXNzLmFyZ3YpLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIChmbiQuY2FsbCh0aGlzLCBpJCwgcmVmJFtpJF0pKTtcbiAgICAgIH1cbiAgICAgIERCRyhcInByb2Nlc3MuZXhlY1BhdGggPSBcIiArIHByb2Nlc3MuZXhlY1BhdGgpO1xuICAgICAgREJHKFwicHJvY2Vzcy5hcmNoID0gXCIgKyBwcm9jZXNzLmFyY2gpO1xuICAgICAgREJHKFwicHJvY2Vzcy5wbGF0Zm9ybSA9IFwiICsgcHJvY2Vzcy5wbGF0Zm9ybSk7XG4gICAgICBEQkcoXCJwcm9jZXNzLmN3ZCgpID0gXCIgKyBwcm9jZXNzLmN3ZCgpKTtcbiAgICAgIERCRyhcInBhdGgubm9ybWFsaXplKCcuJykgPSBcIiArIHBhdGgubm9ybWFsaXplKCcuJykpO1xuICAgICAgREJHKFwicGF0aC5ub3JtYWxpemUoX19kaXJuYW1lKSA9IFwiICsgcGF0aC5ub3JtYWxpemUoX19kaXJuYW1lKSk7XG4gICAgICBEQkcoXCJwYXRoLnJlc29sdmUoJy4nKSA9IFwiICsgcGF0aC5yZXNvbHZlKCcuJykpO1xuICAgICAgcmV0dXJuIERCRyhcInBhdGgucmVzb2x2ZShfX2Rpcm5hbWUpID0gXCIgKyBwYXRoLnJlc29sdmUoX19kaXJuYW1lKSk7XG4gICAgICBmdW5jdGlvbiBmbiQoaSwgdil7XG4gICAgICAgIERCRyhcImFyZ3ZbXCIgKyBpICsgXCJdID0gXCIgKyB2KTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9hZCBjb25maWd1cmF0aW9uIGZpbGUgZnJvbSBmb2xsb3dpbmcgZmlsZXMgaW4gb3JkZXJcbiAgICAgKiAgIC0gJHtjb25maWdfZGlyfS8ke25hbWV9LmxzXG4gICAgICogICAtICR7Y29uZmlnX2Rpcn0vJHtuYW1lfS5qc1xuICAgICAqICAgLSAke2NvbmZpZ19kaXJ9LyR7bmFtZX0uanNvblxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUsIHRoZSBuYW1lIG9mIGNvbmZpZ3VyYXRpb24gZmlsZSB0byBiZSBsb2FkZWQuXG4gICAgICovLFxuICAgIGxvYWRDb25maWc6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKXtcbiAgICAgIHZhciBwYXRoZXMsIHJldCwgaSQsIGxlbiQsIHAsIHRleHQsIGVycm9yO1xuICAgICAgcGF0aGVzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcGF0aDogc2V0dGluZ3MuY29uZmlnX2RpciArIFwiXCIgKyBwYXRoLnNlcCArIG5hbWUgKyBcIi5sc1wiLFxuICAgICAgICAgIGpzb246IGZhbHNlXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBwYXRoOiBzZXR0aW5ncy5jb25maWdfZGlyICsgXCJcIiArIHBhdGguc2VwICsgbmFtZSArIFwiLmpzb25cIixcbiAgICAgICAgICBqc29uOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICByZXQgPSB7XG4gICAgICAgIGZvdW5kOiBmYWxzZSxcbiAgICAgICAgY29uZmlnOiBudWxsXG4gICAgICB9O1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBwYXRoZXMubGVuZ3RoOyBpJCA8IGxlbiQ7ICsraSQpIHtcbiAgICAgICAgcCA9IHBhdGhlc1tpJF07XG4gICAgICAgIGlmIChyZXQuZm91bmQpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgIERCRyhcInRyeSBcIiArIHAucGF0aCArIFwiIC4uLlwiKTtcbiAgICAgICAgICB0ZXh0ID0gZnMucmVhZEZpbGVTeW5jKHAucGF0aCkgKyBcIlwiO1xuICAgICAgICAgIGlmICghcC5qc29uKSB7XG4gICAgICAgICAgICB0ZXh0ID0gcmVxdWlyZSgnbGl2ZXNjcmlwdCcpLmNvbXBpbGUodGV4dCwge1xuICAgICAgICAgICAgICBqc29uOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0LmNvbmZpZyA9IEpTT04ucGFyc2UodGV4dCk7XG4gICAgICAgICAgcmV0LmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgfSBjYXRjaCAoZSQpIHtcbiAgICAgICAgICBlcnJvciA9IGUkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwic3RhY2s6IFwiICsgZXJyb3Iuc3RhY2spO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIXJldC5mb3VuZCkge1xuICAgICAgICBEQkcoXCJjYW5ub3QgZmluZCBjb25maWcgXCIgKyBuYW1lKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQuY29uZmlnO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNvbHZlIHRvIGFuIGFic29sdXRlIHBhdGggdG8gdGhlIGZpbGUgaW4gdGhlIHNwZWNpZmllZFxuICAgICAqIGB0eXBlYCBkaXJlY3RvcnksIHJlbGF0ZWQgdG8gd29ya19kaXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHlwZSwgdGhlIHR5cGUgb2YgZGlyZWN0b3J5LCBlLmcuICdsb2dzJywgJ3NjcmlwdHMnLCAuLi5cbiAgICAgKiBAcGFyYW0gZmlsZW5hbWUsIHRoZSBuYW1lIG9mIHRoYXQgZmlsZS5cbiAgICAgKi8sXG4gICAgcmVzb2x2ZVdvcmtQYXRoOiBmdW5jdGlvbih0eXBlLCBmaWxlbmFtZSl7XG4gICAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHNldHRpbmdzLndvcmtfZGlyICsgXCJcIiArIHBhdGguc2VwICsgdHlwZSArIHBhdGguc2VwICsgZmlsZW5hbWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNvbHZlIHRvIGFuIGFic29sdXRlIHBhdGggdG8gdGhlIGZpbGUgaW4gdGhlIHNwZWNpZmllZFxuICAgICAqIGB0eXBlYCBkaXJlY3RvcnksIHJlbGF0ZWQgdG8gYXBwX2Rpci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0eXBlLCB0aGUgdHlwZSBvZiBkaXJlY3RvcnksIGUuZy4gJ2xvZ3MnLCAnc2NyaXB0cycsIC4uLlxuICAgICAqIEBwYXJhbSBmaWxlbmFtZSwgdGhlIG5hbWUgb2YgdGhhdCBmaWxlLlxuICAgICAqLyxcbiAgICByZXNvbHZlUmVzb3VyY2VQYXRoOiBmdW5jdGlvbih0eXBlLCBmaWxlbmFtZSl7XG4gICAgICB2YXIgcmV0O1xuICAgICAgcmV0ID0gcGF0aC5yZXNvbHZlKHNldHRpbmdzLmFwcF9kaXIgKyBcIlwiICsgcGF0aC5zZXAgKyB0eXBlICsgcGF0aC5zZXAgKyBmaWxlbmFtZSk7XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb2FkIGphdmFzY3JpcHQsIGxpdmVzY3JpcHQsIG9yIGNvZmZlZXNjcmlwdCBmcm9tICR7YXBwX2Rpcn0vbGliLiBGb3IgZXhhbXBsZSxcbiAgICAgKiB3aGVuIGBsb2FkU2NyaXB0ICdmb28nYCBpcyBjYWxsZWQsIHRoZSBmdW5jdGlvbiB0cmllcyB0byBsb2FkIHNjcmlwdHMgb25lLWJ5LW9uZVxuICAgICAqIGFzIGZvbGxvd2luZyBvcmRlcjpcbiAgICAgKlxuICAgICAqICAgIDEuICR7YXBwX2Rpcn0vbGliL2Zvby5qc1xuICAgICAqICAgIDIuICR7YXBwX2Rpcn0vbGliL2Zvby5sc1xuICAgICAqXG4gICAgICogQG5hbWUge1t0eXBlXX1cbiAgICAgKi8sXG4gICAgbG9hZFNjcmlwdDogZnVuY3Rpb24obmFtZSl7XG4gICAgICByZXR1cm4gcmVxdWlyZShzZXR0aW5ncy5hcHBfZGlyICsgXCJcIiArIHBhdGguc2VwICsgXCJsaWJcIiArIHBhdGguc2VwICsgbmFtZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvYWQgamF2YXNjcmlwdCwgbGl2ZXNjcmlwdCwgb3IgY29mZmVlc2NyaXB0IGZyb20gJHthcHBfZGlyfS9saWIvcGx1Z2lucy4gRm9yIGV4YW1wbGUsXG4gICAgICogd2hlbiBgbG9hZFBsdWdpbiAnZm9vJ2AgaXMgY2FsbGVkLCB0aGUgZnVuY3Rpb24gdHJpZXMgdG8gbG9hZCBzY3JpcHRzIG9uZS1ieS1vbmVcbiAgICAgKiBhcyBmb2xsb3dpbmcgb3JkZXI6XG4gICAgICpcbiAgICAgKiAgICAxLiAke2FwcF9kaXJ9L2xpYi9wbHVnaW5zL2Zvby5qc1xuICAgICAqICAgIDIuICR7YXBwX2Rpcn0vbGliL3BsdWdpbnMvZm9vLmxzXG4gICAgICogICAgMy4gJHthcHBfZGlyfS9saWIvcGx1Z2lucy9mb28vaW5kZXguanNcbiAgICAgKiAgICA0LiAke2FwcF9kaXJ9L2xpYi9wbHVnaW5zL2Zvby9pbmRleC5sc1xuICAgICAqICAgIDUuICR7ZXN5c19tb2R1bGVzfS9iYXNlL2xpYi9wbHVnaW5zL2Zvby5qc1xuICAgICAqICAgIDYuICR7ZXN5c19tb2R1bGVzfS9iYXNlL2xpYi9wbHVnaW5zL2Zvby5sc1xuICAgICAqICAgIDcuICR7ZXN5c19tb2R1bGVzfS9iYXNlL2xpYi9wbHVnaW5zL2Zvby9pbmRleC5qc1xuICAgICAqICAgIDguICR7ZXN5c19tb2R1bGVzfS9iYXNlL2xpYi9wbHVnaW5zL2Zvby9pbmRleC5sc1xuICAgICAqXG4gICAgICogQG5hbWUge1t0eXBlXX1cbiAgICAgKi8sXG4gICAgbG9hZFBsdWdpbjogZnVuY3Rpb24obmFtZSl7XG4gICAgICB2YXIgbGliLCBwbHVnaW5zLCBlcnJvcnMsIHBhdGhlcywgZm91bmQsIG0sIGkkLCBsZW4kLCBleHg7XG4gICAgICBsaWIgPSAnbGliJztcbiAgICAgIHBsdWdpbnMgPSAncGx1Z2lucyc7XG4gICAgICBlcnJvcnMgPSBbXTtcbiAgICAgIHBhdGhlcyA9IFtzZXR0aW5ncy5hcHBfZGlyICsgXCJcIiArIHBhdGguc2VwICsgbGliICsgcGF0aC5zZXAgKyBwbHVnaW5zICsgcGF0aC5zZXAgKyBuYW1lLCBzZXR0aW5ncy5hcHBfZGlyICsgXCJcIiArIHBhdGguc2VwICsgbGliICsgcGF0aC5zZXAgKyBwbHVnaW5zICsgcGF0aC5zZXAgKyBuYW1lICsgcGF0aC5zZXAgKyBcImluZGV4XCIsIF9fZGlybmFtZSArIFwiXCIgKyBwYXRoLnNlcCArIHBsdWdpbnMgKyBwYXRoLnNlcCArIG5hbWUsIF9fZGlybmFtZSArIFwiXCIgKyBwYXRoLnNlcCArIHBsdWdpbnMgKyBwYXRoLnNlcCArIG5hbWUgKyBwYXRoLnNlcCArIFwiaW5kZXhcIl07XG4gICAgICBmb3VuZCA9IGZhbHNlO1xuICAgICAgbSA9IG51bGw7XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IHBhdGhlcy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICAoZm4kLmNhbGwodGhpcywgaSQsIHBhdGhlc1tpJF0pKTtcbiAgICAgIH1cbiAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICByZXR1cm4gbTtcbiAgICAgIH1cbiAgICAgIGZvciAoaSQgPSAwLCBsZW4kID0gZXJyb3JzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIChmbjEkLmNhbGwodGhpcywgaSQsIGVycm9yc1tpJF0pKTtcbiAgICAgIH1cbiAgICAgIGV4eCA9IGVycm9ycy5wb3AoKTtcbiAgICAgIHRocm93IGV4eC5lcnI7XG4gICAgICBmdW5jdGlvbiBmbiQoaSwgcCl7XG4gICAgICAgIHZhciBlcnJvciwgZXh4O1xuICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG0gPSByZXF1aXJlKHApO1xuICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgIH0gY2F0Y2ggKGUkKSB7XG4gICAgICAgICAgICBlcnJvciA9IGUkO1xuICAgICAgICAgICAgZXh4ID0ge1xuICAgICAgICAgICAgICBlcnI6IGVycm9yLFxuICAgICAgICAgICAgICBwYXRoOiBwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXJyb3JzLnB1c2goZXh4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGZuMSQoaSwgZXh4KXtcbiAgICAgICAgREJHKFwibG9hZGluZyBcIiArIGV4eC5wYXRoICsgXCIgYnV0IGVycjogXCIgKyBleHguZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBwcm9ncmFtIG5hbWUgb2YgZW50cnkgamF2YXNjcmlwdCAobGl2ZXNjcmlwdCkgZm9yXG4gICAgICogbm9kZWpzIHRvIGV4ZWN1dGUuXG4gICAgICovLFxuICAgIGdldFByb2dyYW1OYW1lOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNldHRpbmdzLnByb2dyYW1fbmFtZTtcbiAgICB9LFxuICAgIGdldEFwcERpcjogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXR0aW5ncy5hcHBfZGlyO1xuICAgIH0sXG4gICAgZ2V0V29ya0RpcjogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBzZXR0aW5ncy53b3JrX2RpcjtcbiAgICB9XG4gIH07XG4gIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IHJlc291cmNlO1xufSkuY2FsbCh0aGlzKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBMaXZlU2NyaXB0IDEuNC4wXG4oZnVuY3Rpb24oKXtcbiAgdmFyIG1vbWVudCwgREJHLCB0aW1lckNiQ3VycnlpbmcsIGV4cG9ydHMsIFRpbWVyO1xuICBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcbiAgREJHID0gZnVuY3Rpb24oKXtcbiAgICBpZiAoZ2xvYmFsLmxvZ2dlciAhPSBudWxsKSB7XG4gICAgICByZXR1cm4gZ2xvYmFsLmxvZ2dlci5kZWJ1Zy5hcHBseShnbG9iYWwubG9nZ2VyLCBhcmd1bWVudHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29uc29sZS5sb2cuYXBwbHkoY29uc29sZS5sb2csIGFyZ3VtZW50cyk7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogU2ltcGxlIFVzYWdlIGZvciBUaW1lciBjbGFzc1xuICBcbiAgICAgIHQgPSBuZXcgVGltZXIgMTBzLCBvYmosIGZ1bmNcbiAgICAgIHQgPSBuZXcgVGltZXIgMTBzLCBvYmosIGZ1bmMsIGFyZ3NcbiAgICAgIHQgPSBuZXcgVGltZXIgMTBzLCBmdW5jXG4gICAgICB0ID0gbmV3IFRpbWVyIDEwcywgZnVuYywgYXJnc1xuICBcbiAgICAgIHQuc3RhcnQhXG4gICAgICB0LmNvbmZpZ3VyZSA1c1xuICBcbiAgICAgIHQuc3RvcCFcbiAgICAgIHQuY2xlYW51cCFcbiAgICpcbiAgICovXG4gIHRpbWVyQ2JDdXJyeWluZyA9IGN1cnJ5JChmdW5jdGlvbih0aW1lciwgZHVtbXkpe1xuICAgIHJldHVybiB0aW1lci5jaGVjaygpO1xuICB9KTtcbiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gVGltZXIgPSAoZnVuY3Rpb24oKXtcbiAgICBUaW1lci5kaXNwbGF5TmFtZSA9ICdUaW1lcic7XG4gICAgdmFyIHByb3RvdHlwZSA9IFRpbWVyLnByb3RvdHlwZSwgY29uc3RydWN0b3IgPSBUaW1lcjtcbiAgICBmdW5jdGlvbiBUaW1lcihwZXJpb2QsIHgsIHksIHope1xuICAgICAgdmFyIHR5cGU7XG4gICAgICB0aGlzLnBlcmlvZCA9IHBlcmlvZDtcbiAgICAgIERCRyhcImluaXRpYXRlIHRpbWVyIHcvIHBlcmlvZCA9IFwiICsgcGVyaW9kKTtcbiAgICAgIHRoaXMuYXJncyA9IFtdO1xuICAgICAgdGhpcy5vYmogPSBudWxsO1xuICAgICAgdGhpcy5pbnRlcnZhbF9vYmogPSBudWxsO1xuICAgICAgdGhpcy5sYXN0X2ludm9jYXRpb24gPSBudWxsO1xuICAgICAgdGhpcy5jYWxsYmFjayA9IHRpbWVyQ2JDdXJyeWluZyh0aGlzKTtcbiAgICAgIHR5cGUgPSB0eXBlb2YgeDtcbiAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT09IHR5cGUpIHtcbiAgICAgICAgdGhpcy50eXBlID0gXCJjb250ZXh0bGVzc1wiO1xuICAgICAgICB0aGlzLmZ1bmMgPSB4O1xuICAgICAgICBpZiAoeSAhPSBudWxsICYmIFwiYXJyYXlcIiA9PT0gdHlwZW9mIHkpIHtcbiAgICAgICAgICB0aGlzLmFyZ3MgPSB5O1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKFwib2JqZWN0XCIgPT09IHR5cGVvZiB4ICYmIFwic3RyaW5nXCIgPT09IHR5cGVvZiB5KSB7XG4gICAgICAgIHRoaXMudHlwZSA9IFwiY29udGV4dFwiO1xuICAgICAgICB0aGlzLm9iaiA9IHg7XG4gICAgICAgIHRoaXMuZnVuYyA9IHhbeV07XG4gICAgICAgIGlmICh6ICE9IG51bGwgJiYgXCJhcnJheVwiID09PSB0eXBlb2Ygeikge1xuICAgICAgICAgIHRoaXMuYXJncyA9IHo7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZnVuYyA9PSBudWxsKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZnVuY3Rpb24gXCIgKyB5ICsgXCIgbm90IGZvdW5kXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIGFyZ3VtZW50cyBmb3IgdGltZXIgY3JlYXRpb25cIik7XG4gICAgICB9XG4gICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuaW50ZXJ2YWxfb2JqID0gc2V0SW50ZXJ2YWwodGhpcy5jYWxsYmFjaywgNTAwKTtcbiAgICAgIHRoaXMubGFzdF9pbnZvY2F0aW9uID0gbW9tZW50KCk7XG4gICAgfVxuICAgIHByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5ydW5uaW5nID0gdHJ1ZTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5jbGVhbnVwID0gZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbF9vYmopO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uKHBlcmlvZCl7XG4gICAgICB0aGlzLnBlcmlvZCA9IHBlcmlvZDtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5nZXRQZXJpb2QgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMucGVyaW9kO1xuICAgIH07XG4gICAgcHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBub3c7XG4gICAgICBpZiAoIXRoaXMucnVubmluZykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBub3cgPSBtb21lbnQoKTtcbiAgICAgIG5vdy5zdWJ0cmFjdCh0aGlzLnBlcmlvZCwgJ3NlY29uZHMnKTtcbiAgICAgIGlmIChub3cgPiB0aGlzLmxhc3RfaW52b2NhdGlvbikge1xuICAgICAgICB0aGlzLmZ1bmMuYXBwbHkodGhpcy5vYmosIHRoaXMuYXJncyk7XG4gICAgICAgIHJldHVybiB0aGlzLmxhc3RfaW52b2NhdGlvbiA9IG1vbWVudCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIFRpbWVyO1xuICB9KCkpO1xuICBmdW5jdGlvbiBjdXJyeSQoZiwgYm91bmQpe1xuICAgIHZhciBjb250ZXh0LFxuICAgIF9jdXJyeSA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgIHJldHVybiBmLmxlbmd0aCA+IDEgPyBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgcGFyYW1zID0gYXJncyA/IGFyZ3MuY29uY2F0KCkgOiBbXTtcbiAgICAgICAgY29udGV4dCA9IGJvdW5kID8gY29udGV4dCB8fCB0aGlzIDogdGhpcztcbiAgICAgICAgcmV0dXJuIHBhcmFtcy5wdXNoLmFwcGx5KHBhcmFtcywgYXJndW1lbnRzKSA8XG4gICAgICAgICAgICBmLmxlbmd0aCAmJiBhcmd1bWVudHMubGVuZ3RoID9cbiAgICAgICAgICBfY3VycnkuY2FsbChjb250ZXh0LCBwYXJhbXMpIDogZi5hcHBseShjb250ZXh0LCBwYXJhbXMpO1xuICAgICAgfSA6IGY7XG4gICAgfTtcbiAgICByZXR1cm4gX2N1cnJ5KCk7XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgTGl2ZVNjcmlwdCAxLjQuMFxuKGZ1bmN0aW9uKCl7XG4gIHZhciBta2RpcnAsIGFzeW5jLCB1dGlsLCBleHBvcnRzO1xuICBta2RpcnAgPSByZXF1aXJlKCdta2RpcnAnKTtcbiAgYXN5bmMgPSByZXF1aXJlKCdhc3luYycpO1xuICB1dGlsID0ge1xuICAgIGNyZWF0ZURpcmVjdG9yaWVzOiBmdW5jdGlvbihkaXJzLCBjYWxsYmFjayl7XG4gICAgICB2YXIgZnVuY3MsIGNyZWF0ZUN1cnJ5aW5nLCBpJCwgbGVuJDtcbiAgICAgIGZ1bmNzID0gW107XG4gICAgICBjcmVhdGVDdXJyeWluZyA9IGN1cnJ5JChmdW5jdGlvbihkaXIsIGNiKXtcbiAgICAgICAgREJHKFwiY3JlYXRpbmcgXCIgKyBkaXIgKyBcIiAuLi5cIik7XG4gICAgICAgIHJldHVybiBta2RpcnAoZGlyLCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgZm9yIChpJCA9IDAsIGxlbiQgPSBkaXJzLmxlbmd0aDsgaSQgPCBsZW4kOyArK2kkKSB7XG4gICAgICAgIChmbiQuY2FsbCh0aGlzLCBpJCwgZGlyc1tpJF0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhc3luYy5zZXJpZXMoZnVuY3MsIGZ1bmN0aW9uKGVyciwgcmVzdWx0cyl7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgfSk7XG4gICAgICBmdW5jdGlvbiBmbiQoaSwgZGlyKXtcbiAgICAgICAgdmFyIGM7XG4gICAgICAgIGMgPSBjcmVhdGVDdXJyeWluZyhkaXIpO1xuICAgICAgICBmdW5jcy5wdXNoKGMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgY29weU9iamVjdDogZnVuY3Rpb24oZHN0LCBzcmMsIGZpZWxkcyl7XG4gICAgICB2YXIgaSQsIGxlbiQ7XG4gICAgICBmb3IgKGkkID0gMCwgbGVuJCA9IGZpZWxkcy5sZW5ndGg7IGkkIDwgbGVuJDsgKytpJCkge1xuICAgICAgICAoZm4kLmNhbGwodGhpcywgaSQsIGZpZWxkc1tpJF0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkc3Q7XG4gICAgICBmdW5jdGlvbiBmbiQoaSwgZil7XG4gICAgICAgIGlmIChzcmNbZl0gIT0gbnVsbCkge1xuICAgICAgICAgIGRzdFtmXSA9IHNyY1tmXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gdXRpbDtcbiAgZnVuY3Rpb24gY3VycnkkKGYsIGJvdW5kKXtcbiAgICB2YXIgY29udGV4dCxcbiAgICBfY3VycnkgPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgICByZXR1cm4gZi5sZW5ndGggPiAxID8gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHBhcmFtcyA9IGFyZ3MgPyBhcmdzLmNvbmNhdCgpIDogW107XG4gICAgICAgIGNvbnRleHQgPSBib3VuZCA/IGNvbnRleHQgfHwgdGhpcyA6IHRoaXM7XG4gICAgICAgIHJldHVybiBwYXJhbXMucHVzaC5hcHBseShwYXJhbXMsIGFyZ3VtZW50cykgPFxuICAgICAgICAgICAgZi5sZW5ndGggJiYgYXJndW1lbnRzLmxlbmd0aCA/XG4gICAgICAgICAgX2N1cnJ5LmNhbGwoY29udGV4dCwgcGFyYW1zKSA6IGYuYXBwbHkoY29udGV4dCwgcGFyYW1zKTtcbiAgICAgIH0gOiBmO1xuICAgIH07XG4gICAgcmV0dXJuIF9jdXJyeSgpO1xuICB9XG59KS5jYWxsKHRoaXMpO1xuIl19
